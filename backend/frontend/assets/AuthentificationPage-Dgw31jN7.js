import{u as x,r as m,H as v,J as F,j as e,B as I,n as E,K as S,d as _,O as T}from"./index-BxFqVAtU.js";import{u as A}from"./index.esm-DU5Jd49H.js";import{E as g}from"./ErrorComponent-DHhBf5Ed.js";import{E as P}from"./eye-closed-DPJmgXQQ.js";import{E as N}from"./eye-C8R93m4K.js";import{T as j}from"./triangle-alert-Dgnm9sIf.js";class i extends Error{}i.prototype.name="InvalidTokenError";function U(s){return decodeURIComponent(atob(s).replace(/(.)/g,(t,o)=>{let r=o.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function D(s){let t=s.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return U(t)}catch{return atob(t)}}function M(s,t){if(typeof s!="string")throw new i("Invalid token specified: must be a string");t||(t={});const o=t.header===!0?0:1,r=s.split(".")[o];if(typeof r!="string")throw new i(`Invalid token specified: missing part #${o+1}`);let c;try{c=D(r)}catch(n){throw new i(`Invalid token specified: invalid base64 for part #${o+1} (${n.message})`)}try{return JSON.parse(c)}catch(n){throw new i(`Invalid token specified: invalid json for part #${o+1} (${n.message})`)}}const $={verifyToken:s=>M(s)},q="_authFormContainer_176kl_1",B="_authForm_176kl_1",R="_commonFormInputContainer_176kl_39",H="_errorMessage_176kl_66",a={authFormContainer:q,authForm:B,commonFormInputContainer:R,errorMessage:H},J=()=>{const{language:s,translation:t}=x(),{setToken:o,setIsAdmin:r,setUserId:c}=m.useContext(v),[n,k]=m.useState(!1),[p,w]=m.useState(!1),b=F(),y=async d=>{const l=await S(d);if(l){if(o(l.accessToken),l.accessToken){const u=$.verifyToken(l.accessToken);u.userStatus&&(r(u.userStatus==="admin"),c(u.userId||null)),b("/backoffice")}}else k(!0)},{register:h,handleSubmit:C,formState:{errors:f}}=A();return e.jsx("section",{className:a.authFormContainer,children:e.jsxs("form",{className:a.authForm,onSubmit:C(y),children:[e.jsxs("div",{className:a.commonFormInputContainer,children:[e.jsx("label",{htmlFor:"pseudo",children:t[s].backoffice.authPage.username}),e.jsx("input",{type:"text",id:"pseudo",...h("pseudo",{required:!0})}),f.pseudo&&e.jsx(g,{message:t[s].backoffice.authPage.requiredField})]}),e.jsxs("div",{className:a.commonFormInputContainer,children:[e.jsx("label",{htmlFor:"password",children:t[s].backoffice.authPage.password}),e.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx("input",{type:p?"text":"password",id:"password",...h("password",{required:!0})}),e.jsx("button",{type:"button",onClick:()=>w(d=>!d),style:{marginLeft:8},"aria-label":"Changer la visibilitÃ© du mot de passe",children:p?e.jsx(P,{}):e.jsx(N,{})})]}),f.password&&e.jsx(g,{message:t[s].backoffice.authPage.requiredField})]}),n&&e.jsxs("div",{className:a.errorMessage,children:[e.jsx(j,{}),t[s].invalidAuth]}),e.jsx(I,{type:"submit",color:"brown",textContent:t[s].backoffice.authPage.login}),e.jsx(E,{to:"/forgot-password",children:t[s].backoffice.authPage.forgotPassword})]})})},Q=()=>{const{isDesktop:s}=_(),t={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",gap:"2rem",textAlign:"center"},{language:o,translation:r}=x();return e.jsxs(e.Fragment,{children:[e.jsx(T,{}),s?e.jsx(J,{}):e.jsxs("section",{style:t,children:[e.jsx(j,{width:"30px",color:"#9d2121"}),e.jsx("p",{children:r[o].noAuthInMobile})]})]})};export{Q as default};
