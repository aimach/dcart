import{c as te,u as A,E as H,J as le,j as e,B as E,C as ne,r as p,a2 as ue,f as he,S as Y,q as ee,p as w,a3 as ae,e as pe,l as fe,a4 as xe,W as ge,a1 as ie,a5 as be,a6 as ye,a7 as je,z as Ce}from"./index-BxFqVAtU.js";import{u as Fe,C as ve}from"./index.esm-DU5Jd49H.js";import{u as D,T as Q}from"./mapFormStore-BBEqQX7u.js";import{u as Z,g as ke}from"./icons-BCZYgyQa.js";import{C as _e}from"./chevron-left-hb2Ok2KW.js";import{E as W,C as U}from"./ErrorComponent-DHhBf5Ed.js";import{s as u,E as Ne,U as Pe,P as Le,F as we,h as Se,X as Me}from"./UpdatePointSetContent-CXd8D4KU.js";import{L as P}from"./LabelComponent-Dc0vkv4j.js";import{c as qe,a as Te,d as Ee,b as Ae}from"./deleteRequests-D1QlB_A_.js";import{a as ce,b as De,c as Oe,d as Ie,e as G}from"./putRequests-B23pqD-4.js";import{T as Re}from"./triangle-alert-Dgnm9sIf.js";import{C as $e}from"./circle-plus-Cot57x0J.js";import{C as Be}from"./circle-help-Bu1jh18z.js";import{P as ze}from"./pen-DtWmPD_s.js";import{t as oe,v as Ue,w as re,e as X,r as He,F as Je}from"./filter-Bjeeb-CA.js";import"./purify.es-CEVJ7K31.js";import"./getRequests-D7Jc80Z1.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Ke=te("FileText",Ve);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["rect",{x:"3",y:"5",width:"6",height:"6",rx:"1",key:"1defrl"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]],Ge=te("ListTodo",We);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["path",{d:"M19.43 12.935c.357-.967.57-1.955.57-2.935a8 8 0 0 0-16 0c0 4.993 5.539 10.193 7.399 11.799a1 1 0 0 0 1.202 0 32.197 32.197 0 0 0 .813-.728",key:"1dq61d"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"m16 18 2 2 4-4",key:"1mkfmb"}]],Ze=te("MapPinCheck",Xe),Qe="_navigationButtonContainer_18hvm_1",Ye={navigationButtonContainer:Qe},se=({step:n,nextButtonDisplayed:o,onChangeFunction:l})=>{const{translation:t,language:s}=A(),{pathname:h}=H(),{decrementStep:r,incrementStep:g}=D(Z(_=>_)),y=le();return e.jsxs("div",{className:Ye.navigationButtonContainer,children:[n>1&&e.jsx(E,{type:"button",color:"brown",textContent:t[s].common.previous,onClickFunction:()=>{r(n)},icon:e.jsx(_e,{})}),n===2&&o&&e.jsx(E,{type:"button",color:"brown",textContent:t[s].common.next,onClickFunction:()=>{g(n),l&&l()},icon:e.jsx(ne,{})}),n!==2&&o&&e.jsx(E,{type:"submit",color:"brown",textContent:n<=2?t[s].common.next:t[s].backoffice.mapFormPage[h.includes("create")?"create":"edit"],icon:e.jsx(ne,{})}),n===3&&e.jsx(E,{type:"button",color:"brown",textContent:t[s].common.close,onClickFunction:()=>y("/backoffice/maps")})]})},et=({inputs:n,setIsMapCreated:o})=>{const{translation:l,language:t}=A(),{tagOptions:s}=p.useContext(ue),{pathname:h,state:r}=H(),{mapId:g,mapSlug:y}=he(),_=g??y,{mapInfos:d,setMapInfos:m,step:j,incrementStep:C}=D(Z(a=>a)),k=a=>{const b=a.map(I=>I.value).join("|"),O={...d,tags:b};m(O)},i=async a=>{if(h.includes("create")){const b=await qe({...d,...a});(b==null?void 0:b.status)===201&&(m(b.data),o(!0),C(j),ae("Carte",!0))}else if(h.includes("edit")){const b=await ce(d);(b==null?void 0:b.status)===200&&(m(b.data),C(j))}},{control:x,register:f,handleSubmit:N,watch:S,formState:{errors:T}}=Fe({defaultValues:d??{}});p.useEffect(()=>{const a=async()=>{const b=await w(_);m(b)};r!=null&&r.from.includes("/maps/preview/")&&a()},[_,r]),p.useEffect(()=>{const a=S(b=>{m(b)});return()=>a.unsubscribe()},[S]),p.useEffect(()=>{(async()=>{for(const b of n)b.name==="tag"&&(b.options=[{value:"0",label:"Choisir un tag"},...s])})()},[t]);const M=p.useRef(null),q=p.useMemo(()=>{var a;return(a=d==null?void 0:d.tags)==null?void 0:a.map(b=>({value:b.id,label:b[`name_${t}`]}))},[t]);return e.jsxs("form",{onSubmit:N(i),className:u.commonFormContainer,children:[e.jsx("h4",{children:l[t].backoffice.mapFormPage.addMapIntro}),n.map(a=>{var b,O,I,J,V,K;if(a.type==="select")return e.jsxs("div",{className:u.commonFormInputContainer,children:[e.jsx(P,{htmlFor:a.name,label:a[`label_${t}`],description:a[`description_${t}`]??"",isRequired:a.required.value}),e.jsxs("div",{className:u.inputContainer,children:[e.jsx("select",{...f(a.name,{required:a.required.value}),children:(b=a.options)==null?void 0:b.map(R=>e.jsx("option",{value:R.value,children:R.label},R.value))}),T[a.name]&&e.jsx(W,{message:(O=a.required.message)==null?void 0:O[t]})]})]},a.name);if(a.type==="text")return e.jsxs("div",{className:u.commonFormInputContainer,children:[e.jsx(P,{htmlFor:a.name,label:a[`label_${t}`],description:a[`description_${t}`]??"",isRequired:a.required.value}),e.jsxs("div",{className:u.inputContainer,children:[e.jsx("input",{...f(a.name,{required:a.required.value})}),a.required.value&&T[a.name]&&e.jsx(W,{message:(I=a.required.message)==null?void 0:I[t]})]})]},a.name);if(a.type==="wysiwyg")return e.jsxs("div",{className:u.commonFormInputContainer,children:[e.jsx(P,{htmlFor:a.name,label:a[`label_${t}`],description:a[`description_${t}`]??"",isRequired:a.required.value}),e.jsxs("div",{className:u.inputContainer,children:[e.jsx(ve,{name:a.name,control:x,rules:{required:a.required.value,maxLength:2e3},render:({field:{onChange:R}})=>e.jsx(Ne,{ref:M,onChange:R,defaultValue:d?d[`${a.name}`]:null})}),a.required.value&&((J=T[a.name])==null?void 0:J.type)==="required"&&e.jsx(W,{message:(V=a.required.message)==null?void 0:V[t]}),T[a.name]&&((K=T[a.name])==null?void 0:K.type)==="maxLength"&&e.jsx(W,{message:"1000 char. max"})]})]},a.name)}),e.jsxs("div",{className:u.commonFormInputContainer,children:[e.jsx(P,{htmlFor:"tags",label:l[t].backoffice.mapFormPage.intro.tags.label,description:l[t].backoffice.mapFormPage.intro.tags.description}),e.jsxs("div",{className:u.inputContainer,children:[e.jsx(Y,{styles:ee,options:s,defaultValue:d?q:[],delimiter:"|",isMulti:!0,onChange:a=>k(a),placeholder:l[t].backoffice.mapFormPage.intro.tags.placeholder}),h.includes("edit")&&(d==null?void 0:d.tags.length)===0&&e.jsxs("p",{className:u.errorMessage,children:[e.jsx(Re,{size:20})," ",l[t].alert.noTagAssociated]})]})]}),e.jsxs("div",{className:u.commonFormInputContainer,children:[e.jsx(P,{htmlFor:"divinity_in_chart",label:l[t].backoffice.mapFormPage.intro.divinityInChart.label,description:l[t].backoffice.mapFormPage.intro.divinityInChart.description}),e.jsxs("div",{className:u.inputContainer,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"true",children:l[t].backoffice.mapFormPage.intro.divinityInChart.checkbox.divinity}),e.jsx("input",{...f("divinity_in_chart"),type:"radio",id:"true",name:"divinity_in_chart",value:"true",defaultChecked:d==null?void 0:d.divinity_in_chart})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"false",children:l[t].backoffice.mapFormPage.intro.divinityInChart.checkbox.epithet}),e.jsx("input",{...f("divinity_in_chart"),type:"radio",id:"false",name:"divinity_in_chart",value:"false",defaultChecked:!(d!=null&&d.divinity_in_chart)})]})]})]}),e.jsx(se,{step:j,nextButtonDisplayed:!0})]})},tt=()=>{const{translation:n,language:o}=A(),{hasGrayScale:l}=pe(),{mapInfos:t,setMapInfos:s,step:h}=D(Z(c=>c)),[r,g]=p.useState(!1),[y,_]=p.useState(!1),[d,m]=p.useState(null),{pathname:j}=H(),[C,k]=p.useState(j.includes("edit")),[i,x]=p.useState(null),[f,N]=p.useState("create"),S=(i==null?void 0:i.name_fr)&&i.name_fr!==""&&i.name_en&&i.name_en!==""&&i.attestationIds&&i.attestationIds!=="",T=async c=>{if(c.preventDefault(),!S){ge("Veuillez remplir tous les champs obligatoires du formulaire.");return}if(f==="create"){const F=await Te(i);if((F==null?void 0:F.status)===201){q(!0);const v=await w(t==null?void 0:t.id);s(v),ae("Jeu de points",!1),x(null)}}if(f==="edit"){const F=await De(i);if((F==null?void 0:F.status)===200){const v=await w(t==null?void 0:t.id);s(v),ie("Jeu de points",!1),x(null)}}},[M,q]=p.useState(!1);p.useEffect(()=>{t!=null&&t.attestations&&q(!0),(t!=null&&t.attestations||M)&&k(!0)},[t]);const[a,b]=p.useState([]);p.useEffect(()=>{if(t!=null&&t.attestations){const F=t.attestations.map(v=>v.position).sort((v,$)=>v-$);b(F)}},[t==null?void 0:t.attestations]);const O=async c=>{await Ee(c);const F=await w(t==null?void 0:t.id);s(F),be("Jeu de points",!1)},I=async c=>{const F=t==null?void 0:t.attestations.find(v=>v.id===c);F&&(N("edit"),x({...F,mapId:t==null?void 0:t.id,icon:F.icon.id,color:F.color.id}),q(!1))},[J,V]=p.useState((t==null?void 0:t.isLayered)??!1),[K,R]=p.useState((t==null?void 0:t.isNbDisplayed)??!1),de=async(c,F)=>{const v=await ce({...t,isLayered:c,isNbDisplayed:F});s({...t,isLayered:v==null?void 0:v.data.isLayered,isNbDisplayed:v==null?void 0:v.data.isNbDisplayed})},me=async(c,F)=>{const v=await Oe(c,F,t==null?void 0:t.id,"map");if((v==null?void 0:v.status)===200){const $=await w(t==null?void 0:t.id);s($),ie("Position du jeu de points",!0)}};return e.jsxs("section",{className:u.uploadFormContainer,children:[y&&e.jsx(fe,{onClose:()=>{_(!1)},children:e.jsx(Pe,{idToUpdate:d,setIsModalOpen:_,reload:r,setReload:g,mapType:"map",pointType:"bdd"})}),e.jsxs("div",{className:u.titleAndHelpContainer,children:[e.jsx("h4",{children:n[o].backoffice.mapFormPage.addMapPoints}),M&&e.jsx(E,{type:"button",color:"brown",textContent:"Ajouter un nouveau jeu de points",onClickFunction:()=>q(!M),icon:e.jsx($e,{})})]}),e.jsx("div",{className:u.helpContainer,children:e.jsxs("a",{href:"https://sharedocs.huma-num.fr/wl/?id=dJrDrFA2uDDRqqo5PGnmnkNzaNpFWSEW&fmode=open",target:"_blank",rel:"noreferrer",children:[e.jsx(Be,{color:"grey"}),n[o].backoffice.mapFormPage.uploadPointsHelp]})}),!M&&e.jsx(Le,{pointSet:i,setPointSet:x,handleSubmit:T,parentId:t==null?void 0:t.id,type:"map",action:f,cancelFunction:()=>{x(null),q(!0),N("create")}}),(t==null?void 0:t.attestations)&&e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:u.pointSetTable,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"Position"}),e.jsx("th",{scope:"col",children:n[o].backoffice.mapFormPage.pointSetTable.nameLang1}),e.jsx("th",{scope:"col",children:n[o].backoffice.mapFormPage.pointSetTable.nameLang2}),e.jsx("th",{scope:"col",children:n[o].backoffice.mapFormPage.pointSetTable.icon}),e.jsx("th",{children:n[o].backoffice.mapFormPage.pointSetTable.downloadCSV}),e.jsx("th",{children:n[o].backoffice.mapFormPage.pointSetTable.lastActivity}),e.jsx("th",{scope:"col"})]})}),e.jsx("tbody",{children:t.attestations.sort((c,F)=>c.position-F.position).map(c=>{var v,$;const F=ke((v=c.icon)==null?void 0:v.name_en,($=c.color)==null?void 0:$.code_hex,l);return e.jsx(e.Fragment,{children:e.jsxs("tr",{className:u.pointSetTableRow,children:[e.jsx("td",{children:e.jsx("select",{name:"position",id:"position",onChange:B=>{me(c.id,B.target.value)},value:c.position,children:a.map(B=>e.jsx("option",{value:B,children:B},B))})}),e.jsx("td",{children:c.name_fr}),e.jsx("td",{children:c.name_en}),e.jsx("td",{children:e.jsx("p",{dangerouslySetInnerHTML:{__html:F}})}),e.jsx("td",{children:c!=null&&c.attestationIds?e.jsx(we,{onClick:()=>Se(c,`${c.name_fr}.csv`,"mapPoints"),cursor:c!=null&&c.attestationIds?"pointer":"not-allowed",color:c!=null&&c.attestationIds?"black":"grey"}):e.jsxs("p",{style:{textAlign:"center"},children:[e.jsx(U,{color:"#9d2121"})," ",e.jsx("p",{style:{color:"#9d2121"},children:n[o].backoffice.noPointInPointSet})]})}),e.jsx("td",{children:c.lastActivity?new Date(c.lastActivity).toLocaleDateString(o,{year:"numeric",month:"long",day:"numeric"}):null}),e.jsxs("td",{children:[e.jsx(Q,{text:n[o].button.clean,children:xe(c.id,c.attestationIds==="",m,_)}),e.jsx(Q,{text:n[o].button.edit,children:e.jsx(ze,{onClick:()=>I(c.id),onKeyDown:()=>I(c.id)})}),e.jsx(Q,{text:n[o].button.delete,children:e.jsx(Me,{onClick:()=>O(c.id),onKeyDown:()=>O(c.id),color:"#9d2121"})})]})]},c.id)})})})]}),e.jsxs("div",{children:[(t==null?void 0:t.attestations.length)>1&&e.jsxs("div",{className:u.isLayeredContainer,children:[e.jsx("input",{id:"isLayered",name:"isLayered",type:"checkbox",onChange:c=>V(c.target.checked),defaultChecked:t.isLayered}),e.jsx("label",{htmlFor:"isLayered",children:n[o].backoffice.mapFormPage.pointSetForm.isLayeredLabel})]}),e.jsxs("div",{className:u.isLayeredContainer,children:[e.jsx("input",{id:"isNbDisplayed",name:"isNbDisplayed",type:"checkbox",onChange:c=>R(c.target.checked),defaultChecked:t.isNbDisplayed}),e.jsx("label",{htmlFor:"isNbDisplayed",children:n[o].backoffice.mapFormPage.pointSetForm.isNbDisplayedLabel})]})]})]}),M&&e.jsx(se,{step:h,nextButtonDisplayed:C,onChangeFunction:()=>{de(J,K)}})]},r.toString())},at=()=>{const{translation:n,language:o}=A(),{mapInfos:l,setMapInfos:t,mapFilters:s,setMapFilters:h,resetMapFilters:r,step:g,setStep:y}=D(Z(i=>i)),[_,d]=p.useState([]);p.useEffect(()=>{(async()=>{const x=await ye();if(d(x),l!=null&&l.filterMapContent){const f=x.filter(S=>S.type!=="time").map(S=>{var M;return((M=l.filterMapContent)==null?void 0:M.findIndex(q=>{var a;return((a=q.filter)==null?void 0:a.type)===S.type}))!==-1?{[S.type]:!0}:{[S.type]:!1}}),N=Object.assign({},...f);h(N)}})()},[l==null?void 0:l.filterMapContent]);const m=i=>{(!oe(s)||i.target.checked===!1)&&h({...s,[i.target.name]:i.target.checked})},j=le(),{pathname:C}=H(),k=async i=>{var x;if(i.preventDefault(),C.includes("edit")){const f=await Ie(l==null?void 0:l.id,s);if((f==null?void 0:f.status)===200){const N=await w(l==null?void 0:l.id);t(N),s.element||s.location?s.element?y(4):y(5):y(3)}}else if(C.includes("create"))if(re(s))j("/backoffice/maps");else{const f=await Ae(l==null?void 0:l.id,s);if((f==null?void 0:f.status)===201){const N=await w((x=f.data)==null?void 0:x.mapId);t(N),s.element||s.location?s.element?y(4):y(5):ae("Jeu de filtres",!1)}}};return _&&e.jsxs("form",{onSubmit:k,className:u.commonFormContainer,children:[e.jsx("h4",{children:n[o].backoffice.mapFormPage.addFilters}),e.jsxs("div",{className:u.filterIntroductionContainer,children:[e.jsx(U,{})," ",e.jsx("p",{children:n[o].backoffice.mapFormPage.filterIntroduction})]}),oe(s)&&e.jsxs("div",{className:u.alertContainer,children:[e.jsx(U,{color:"#9d2121"}),e.jsx("p",{children:n[o].alert.maxReached})]}),_.sort((i,x)=>i.type<x.type?-1:i.type>x.type?1:0).map(i=>{const{label:x,description:f}=Ue(i.type,n,o);if(i.type!=="time")return e.jsxs("div",{className:u.commonFormInputContainer,style:{justifyContent:"flex-start"},children:[e.jsxs("div",{className:u.labelContainer,children:[e.jsx("label",{htmlFor:i.type,children:x}),e.jsx("p",{children:f})]}),e.jsx("input",{id:i.type,name:i.type,type:"checkbox",checked:s[i.type],onChange:N=>m(N)})]},i.type)}),e.jsxs("div",{className:u.commonFormInputContainer,style:{justifyContent:"flex-start"},children:[e.jsxs("div",{className:u.labelContainer,children:[e.jsx("label",{htmlFor:"noFilter",children:n[o].backoffice.mapFormPage.noFilter.label}),e.jsx("p",{children:n[o].backoffice.mapFormPage.noFilter.description})]}),e.jsx("input",{id:"noFilter",name:"noFilter",type:"checkbox",checked:re(s),onChange:r})]}),e.jsx(se,{step:g,nextButtonDisplayed:!0})]})},st="_selectElementFormContainer_fvnez_1",nt="_allSelectContainer_fvnez_10",it="_selectContainer_fvnez_24",ot="_buttonContainer_fvnez_29",z={selectElementFormContainer:st,allSelectContainer:nt,selectContainer:it,buttonContainer:ot},rt=({elementOptions:n})=>{const{translation:o,language:l}=A(),{mapInfos:t,setMapInfos:s}=D(),[h,r]=p.useState([]),[g,y]=p.useState([]);p.useEffect(()=>{var j,C,k,i,x;const m=(j=t==null?void 0:t.filterMapContent)==null?void 0:j.find(f=>f.filter.type==="element");((C=m==null?void 0:m.options)==null?void 0:C.checkbox)!==void 0&&((k=m==null?void 0:m.options)==null?void 0:k.checkbox.length)>0?(y((i=m==null?void 0:m.options)==null?void 0:i.checkbox),r([...(x=m==null?void 0:m.options)==null?void 0:x.checkbox,{firstLevelIds:[],secondLevelIds:[]}])):r([{firstLevelIds:[],secondLevelIds:[]}])},[t]);const _=async m=>{var x;const C={solution:"manual",checkbox:[...h.filter(f=>f.firstLevelIds.length>0)]};await G(t==null?void 0:t.id,"element",JSON.stringify(C));const k=await w(t==null?void 0:t.id);s(k);const i=(x=k.filterMapContent)==null?void 0:x.find(f=>f.filter.type==="element").options.checkbox;y(i),r([...i,{firstLevelIds:[],secondLevelIds:[]}]),m===h.length-1&&r([...h,{firstLevelIds:[],secondLevelIds:[]}])},d=async m=>{const j=h.filter((i,x)=>x!==m);r(j.length>0?j:[{firstLevelIds:[],secondLevelIds:[]}]);const C={solution:"manual",checkbox:[...j.filter(i=>i.firstLevelIds.length>0&&i.secondLevelIds.length>0)]};await G(t==null?void 0:t.id,"element",JSON.stringify(C));const k=await w(t==null?void 0:t.id);s(k),y(j.filter(i=>i.firstLevelIds&&i.secondLevelIds))};return h.length>0&&e.jsx("div",{className:z.selectElementFormContainer,children:h.map((m,j)=>e.jsxs("div",{className:z.allSelectContainer,children:[e.jsxs("div",{children:[e.jsxs("div",{className:z.selectContainer,children:[e.jsx(P,{htmlFor:"firstLevelIds",label:o[l].backoffice.mapFormPage.filterForm.element.firstLevel,description:""}),e.jsx(Y,{styles:ee,options:n,value:m.firstLevelIds[0]||null,onChange:C=>{const k=h[j];if(!k)return;const i=[...h];i[j]={...k,firstLevelIds:[C]},r(i)},placeholder:o[l].mapPage.aside.searchForElement,isClearable:!0,isLoading:n.length===0})]}),e.jsxs("div",{className:z.selectContainer,children:[e.jsx(P,{htmlFor:"secondLevelIds",label:o[l].backoffice.mapFormPage.filterForm.element.secondLevel,description:"",isRequired:!1}),e.jsx(Y,{styles:ee,options:n,value:m.secondLevelIds,isMulti:!0,onChange:C=>{const k=h[j];if(!k)return;const i=[...h];i[j]={...k,secondLevelIds:C},r(i)},placeholder:o[l].mapPage.aside.searchForElement,isClearable:!0,isLoading:n.length===0})]})]}),e.jsxs("div",{className:z.buttonContainer,children:[e.jsx(E,{type:"button",color:"brown",onClickFunction:()=>_(j),textContent:o[l].button.save}),g.some(C=>C.firstLevelIds===m.firstLevelIds&&C.secondLevelIds===m.secondLevelIds)?e.jsx(E,{type:"button",color:"red",onClickFunction:()=>d(j),textContent:o[l].button.delete}):null]})]},`${j}-${m.secondLevelIds[-1]}`))})},lt=()=>{const{translation:n,language:o}=A(),[l,t]=p.useState(""),[s,h]=p.useState([]),{mapInfos:r,setMapInfos:g}=D(),y=r==null?void 0:r.attestations.every(d=>d.attestationIds.length===0);p.useEffect(()=>{var m;const d=X(r,"element");((m=d==null?void 0:d.options)==null?void 0:m.solution)==="manual"&&(async()=>{const C=r==null?void 0:r.attestations.filter(N=>N.attestationIds!=="").map(N=>N.attestationIds),k=C==null?void 0:C.join(",").split(","),i=new Set(k),x=await je([...i].toString()),f=await He(r,x,o,!1,!0);h(f)})()},[r==null?void 0:r.attestations,o]),p.useEffect(()=>{var d;if(t("basic"),r){const m=X(r,"element");m&&t(((d=m.options)==null?void 0:d.solution)??"basic")}},[r]);const _=async d=>{t(d.target.id),await G(r==null?void 0:r.id,"element",JSON.stringify({solution:d.target.id}));const m=await w(r==null?void 0:r.id);g(m)};return e.jsxs("form",{className:u.commonFormContainer,children:[e.jsx("h4",{children:n[o].backoffice.mapFormPage.filterForm.element.title}),y&&e.jsxs("div",{className:u.alertContainer,children:[e.jsx(U,{color:"#9d2121"}),e.jsx("p",{children:"Attention ! Aucun élément n'est accessible. Avez-vous chargé des points dans la carte ?"})]}),e.jsxs("div",{className:u.commonFormInputContainer,children:[e.jsx(P,{htmlFor:"basic",label:n[o].backoffice.mapFormPage.filterForm.element.basic.label,description:n[o].backoffice.mapFormPage.filterForm.element.basic.description,isRequired:!1}),e.jsx("div",{className:u.inputContainer,children:e.jsx("input",{id:"basic",name:"element",type:"radio",onChange:d=>_(d),checked:l==="basic"})})]}),e.jsxs("div",{className:u.commonFormInputContainer,children:[e.jsx(P,{htmlFor:"manual",label:n[o].backoffice.mapFormPage.filterForm.element.manual.label,description:n[o].backoffice.mapFormPage.filterForm.element.manual.description,isRequired:!1}),e.jsx("div",{className:u.inputContainer,children:e.jsx("input",{id:"manual",name:"element",type:"radio",onChange:d=>_(d),checked:l==="manual"})})]}),l==="manual"?y?e.jsxs("div",{className:u.alertContainer,children:[e.jsx(U,{color:"#9d2121"}),e.jsx("p",{children:"Pas d'élément disponible pour construire le filtre."})]}):e.jsx(rt,{elementOptions:s}):null]})},ct=()=>{const{translation:n,language:o}=A(),[l,t]=p.useState(""),{mapInfos:s,setMapInfos:h}=D();p.useEffect(()=>{var g,y;if(s){const _=(g=s.filterMapContent)==null?void 0:g.find(d=>d.filter.type==="location");t(((y=_==null?void 0:_.options)==null?void 0:y.solution)??"greatRegion")}},[s]);const r=async g=>{t(g.target.id),await G(s==null?void 0:s.id,"location",JSON.stringify({solution:g.target.id}));const y=await w(s==null?void 0:s.id);h(y)};return e.jsxs("form",{className:u.commonFormContainer,children:[e.jsx("h4",{children:'Choix du niveau du filtre "Lieu"'}),e.jsxs("div",{className:u.commonFormInputContainer,children:[e.jsx(P,{htmlFor:"greatRegion",label:n[o].backoffice.mapFormPage.filterForm.location.greatRegion.label,description:n[o].backoffice.mapFormPage.filterForm.location.greatRegion.description}),e.jsx("div",{className:u.inputContainer,children:e.jsx("input",{id:"greatRegion",name:"element",type:"radio",onChange:g=>r(g),checked:l==="greatRegion"})})]}),e.jsxs("div",{className:u.commonFormInputContainer,children:[e.jsx(P,{htmlFor:"subRegion",label:n[o].backoffice.mapFormPage.filterForm.location.subRegion.label,description:n[o].backoffice.mapFormPage.filterForm.location.subRegion.description}),e.jsx("div",{className:u.inputContainer,children:e.jsx("input",{id:"subRegion",name:"element",type:"radio",onChange:g=>r(g),checked:l==="subRegion"})})]}),e.jsxs("div",{className:u.commonFormInputContainer,children:[e.jsx(P,{htmlFor:"location",label:n[o].backoffice.mapFormPage.filterForm.location.cityName.label,description:n[o].backoffice.mapFormPage.filterForm.location.cityName.description}),e.jsx("div",{className:u.inputContainer,children:e.jsx("input",{id:"location",name:"element",type:"radio",onChange:g=>r(g),checked:l==="location"})})]})]})},dt=[{label_fr:"Nom de la carte en français",label_en:"Map name in french",description_fr:"Le nom de la carte est affiché dans la liste des cartes et dans la modale d'introduction lorsque l'utilisateur ouvre la carte.",description_en:"The map name is displayed in the map list and in the introduction modal when the user opens the map.",name:"title_fr",type:"text",required:{value:!0,message:{fr:"Le titre en français est requis",en:"French title is required"}}},{label_fr:"Nom de la carte en anglais",label_en:"Map name in english",description_fr:"Le nom de la carte est affiché dans la liste des cartes et dans la modale d'introduction lorsque l'utilisateur ouvre la carte.",description_en:"The map name is displayed in the map list and in the introduction modal when the user opens the map.",name:"title_en",type:"text",required:{value:!0,message:{fr:"Le titre en anglais est requis",en:"English title is required"}}},{label_fr:"Description de la carte en français",label_en:"Map description in french",name:"description_fr",description_fr:"La description de la carte est affichée dans la modale d'introduction lorsque l'utilisateur ouvre la carte.",description_en:"The map description is displayed in the introduction modal when the user opens the map.",type:"wysiwyg",required:{value:!0,message:{fr:"La description en français est requise",en:"French description is required"}}},{label_fr:"Description de la carte en anglais",label_en:"Map description in english",description_fr:"La description de la carte est affichée dans la modale d'introduction lorsque l'utilisateur ouvre la carte.",description_en:"The map description is displayed in the introduction modal when the user opens the map.",name:"description_en",type:"wysiwyg",required:{value:!0,message:{fr:"La description en anglais est requise",en:"English description is required"}}},{label_fr:"Image accompagnant la description",label_en:"Image accompanying the description",description_fr:"L'image est affichée dans la modale d'introduction lorsque l'utilisateur ouvre la carte.",description_en:"The image is displayed in the introduction modal when the user opens the map.",name:"image_url",type:"text",required:{value:!1}}],mt="_BOmapFormPageContainer_1a5n2_1",ut="_mapFormAside_1a5n2_38",ht="_mapFormAsideHeader_1a5n2_44",pt="_isSelected_1a5n2_75",ft="_disabled_1a5n2_78",xt="_mapFormContent_1a5n2_83",L={BOmapFormPageContainer:mt,mapFormAside:ut,mapFormAsideHeader:ht,isSelected:pt,disabled:ft,mapFormContent:xt},Et=()=>{const{translation:n,language:o}=A(),{pathname:l}=H(),{mapInfos:t,step:s,setStep:h}=D(y=>y),[r,g]=p.useState(!1);return p.useEffect(()=>{h(1),l.includes("create")&&g(!1),l.includes("edit")&&g(!0)},[]),e.jsxs("section",{className:L.BOmapFormPageContainer,children:[e.jsxs("aside",{className:L.mapFormAside,children:[e.jsx("div",{className:L.mapFormAsideHeader,children:r&&e.jsx(E,{type:"route",color:"brown",textContent:n[o].backoffice.storymapFormPage.preview,link:`/backoffice/maps/preview/${t==null?void 0:t.id}`})}),e.jsxs("ul",{children:[e.jsxs("li",{onClick:()=>h(1),onKeyUp:()=>h(1),className:s===1?L.isSelected:"",children:[e.jsx(Ke,{size:20}),n[o].backoffice.mapFormPage.aside.informations]}),e.jsxs("li",{onClick:r?()=>h(2):void 0,onKeyUp:r?()=>h(2):void 0,className:`${!r&&L.disabled} ${s===2&&L.isSelected}`,children:[e.jsx(Ce,{size:20}),n[o].backoffice.mapFormPage.aside.pointSets]}),e.jsxs("li",{onClick:r?()=>h(3):void 0,onKeyUp:r?()=>h(3):void 0,className:`${!r&&L.disabled} ${s===3&&L.isSelected}`,children:[e.jsx(Je,{size:20}),n[o].backoffice.mapFormPage.aside.filters]}),X(t,"element")&&e.jsxs("li",{onClick:()=>h(4),onKeyUp:()=>h(4),className:`${s===4&&L.isSelected}`,children:[e.jsx(Ge,{size:20}),"Options filtre éléments"]}),X(t,"location")&&e.jsxs("li",{onClick:()=>h(5),onKeyUp:()=>h(5),className:`${s===5&&L.isSelected}`,children:[e.jsx(Ze,{size:20}),"Options filtre lieux"]})]})]}),e.jsxs("section",{className:L.mapFormContent,children:[s===1&&e.jsx(et,{inputs:dt,setIsMapCreated:g}),s===2&&e.jsx(tt,{}),s===3&&e.jsx(at,{}),s===4&&e.jsx(lt,{}),s===5&&e.jsx(ct,{})]})]})};export{Et as default};
