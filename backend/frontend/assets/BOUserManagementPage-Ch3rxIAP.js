import{U as k,a5 as H,W as q,a1 as B,u as y,P as F,r as c,H as S,j as e,s as U,B as h,J as O,l as N,L as J,af as V,ag as W}from"./index-BxFqVAtU.js";import{u as G}from"./index.esm-DU5Jd49H.js";import{L as K}from"./LabelComponent-Dc0vkv4j.js";import{E as Q,C as X}from"./ErrorComponent-DHhBf5Ed.js";import{s as j}from"./commonForm.module-B0ZibT4L.js";import{C as Y}from"./circle-plus-Cot57x0J.js";import{P as Z}from"./pen-DtWmPD_s.js";import{T as ee}from"./trash-DYE5atLs.js";const se=async()=>{try{return(await k.get("/auth/users/all")).data}catch(t){console.error("Erreur lors du chargement du profil des utilisateurs :",t)}},te=async t=>{try{const s=await k(`auth/users/${t}/status`,{method:"PUT"});if(s.status===200)return B("Utilisateur",!1),s.status}catch{q("Erreur lors de la mise à jour du statut de l'utilisateur")}},ae=async t=>{try{const s=await k.delete(`/auth/users/${t}`);if(s.status===200)return H("Utilisateur",!1),s.status}catch{q("Erreur lors de la suppression d'un utilisateur")}},ne=()=>{const{language:t,translation:s}=y(),{closeDeleteModal:a,idToDelete:i,reload:l,setReload:o}=F(),{userId:d}=c.useContext(S),u=async(m,r)=>{await ae(m)===200&&(r===m?window.location.reload():(a(),o(!l)))};return e.jsxs("div",{className:U.modalCustomContentContainer,children:[s[t].modal.deleteUserText[d===i?"yourself":"another"],e.jsxs("div",{className:U.buttonContainer,children:[e.jsx(h,{type:"button",onClickFunction:()=>u(i,d),color:"green",textContent:s[t].modal.yes}),e.jsx(h,{type:"button",onClickFunction:a,color:"red",textContent:s[t].modal.no})]})]})},oe=()=>{const{language:t,translation:s}=y(),{closeUpdateModal:a,idToUpdate:i,reload:l,setReload:o}=F(),d=async u=>{await te(u)===200&&(a(),o(!l))};return e.jsxs("div",{className:U.modalCustomContentContainer,children:[s[t].modal.modifyUserStatusText,e.jsxs("div",{className:U.buttonContainer,children:[e.jsx(h,{type:"button",onClickFunction:()=>d(i),color:"green",textContent:s[t].modal.yes}),e.jsx(h,{type:"button",onClickFunction:a,color:"red",textContent:s[t].modal.no})]})]})},re=[{label_fr:"Nom d'utilisateur",label_en:"Username",description_fr:"Le nom qui est affiché dans les champs 'création' et 'modification'",description_en:"The name that is displayed in the 'creation' and 'modification' fields",name:"username",type:"text",required:{value:!0,message:{fr:"Le nom d'utilisateur est requis",en:"The username is required"}}},{label_fr:"Pseudo",label_en:"pseudo",description_fr:"Le nom qui est utilisé pour se connecter",description_en:"The name that is used to connect",name:"pseudo",type:"text",required:{value:!0,message:{fr:"Le pseudo est requis",en:"The pseudo is required"}}},{label_fr:"Adresse mail",label_en:"Email address",description_fr:"L'adresse mail est uniquement utilisée pour définir et réinitialiser le mot de passe",description_en:"The email adresse is only used to set and reset the password",name:"email",type:"email",required:{value:!0,message:{fr:"L'adresse email est requise",en:"The email adress is required"}}}],le="_userManagementSection_1ojhz_1",ie="_userManagementHeader_1ojhz_13",ce="_userManagementTableContainer_1ojhz_22",de="_managementTable_1ojhz_26",ue="_userTableRow_1ojhz_38",me="_addUserFormContainer_1ojhz_72",f={userManagementSection:le,userManagementHeader:ie,userManagementTableContainer:ce,managementTable:de,userTableRow:ue,addUserFormContainer:me},he=({onSubmit:t,setAddUserForm:s,type:a,currentUserInfos:i})=>{const{translation:l,language:o}=y(),{register:d,handleSubmit:u,formState:{errors:m}}=G({defaultValues:a==="create"?{}:i??{}});return e.jsx("div",{className:f.addUserFormContainer,children:e.jsxs("form",{onSubmit:u(t),className:j.commonFormContainer,children:[re.map(r=>{var p;return e.jsxs("div",{className:j.commonFormInputContainer,children:[e.jsx(K,{htmlFor:r.name,label:r[`label_${o}`],description:r[`description_${o}`]}),e.jsxs("div",{className:j.inputContainer,children:[e.jsx("input",{...d(r.name,{required:r.required.value})}),r.required.value&&m[r.name]&&e.jsx(Q,{message:(p=r.required.message)==null?void 0:p[o]})]})]},r.name)}),e.jsxs("div",{className:j.commonFormContainerButton,children:[e.jsx(h,{type:"submit",color:"brown",textContent:l[o].backoffice.storymapFormPage.form[a]}),e.jsx(h,{type:"button",color:"brown",textContent:l[o].common.close,onClickFunction:()=>{s(!1)}})]}),a==="create"&&e.jsxs("div",{className:j.alertContainer,children:[e.jsx(X,{color:"#9d2121"}),e.jsx("p",{children:l[o].backoffice.userManagement.passwordManagementMessage})]})]})})},ye=()=>{const{isAdmin:t}=c.useContext(S),{translation:s,language:a}=y(),i=O(),{userId:l}=c.useContext(S),[o,d]=c.useState([]),{openDeleteModal:u,setIdToDelete:m,closeDeleteModal:r,isDeleteModalOpen:p,openUpdateModal:A,setIdToUpdate:E,closeUpdateModal:L,isUpdateModalOpen:D,reload:M,setReload:v}=F(),[_,C]=c.useState("create"),[w,g]=c.useState(null);c.useEffect(()=>{t||i("/backoffice")},[t,i]),c.useEffect(()=>{t&&(async()=>{const T=await se();d(T),T.length>0&&g(T.find($=>$.id===l)||null)})()},[t,M]);const I=n=>{u(),m(n)},P=n=>{A(),E(n)},[b,x]=c.useState(!1),R=async n=>{await V(n),x(!1),g(null),C("create"),v(!M)},z=async n=>{await W(n,w),x(!1),g(null),C("create"),v(!M)};return o.length>0?e.jsxs("section",{className:f.userManagementSection,children:[p&&e.jsx(N,{onClose:()=>r(),children:e.jsx(ne,{})}),D&&e.jsx(N,{onClose:()=>L(),children:e.jsx(oe,{})}),e.jsx("div",{className:f.userManagementHeader,children:e.jsx(h,{type:"button",color:"brown",textContent:b?s[a].button.cancel:s[a].backoffice.userManagement.addUser,onClickFunction:()=>{x(!b),C("create")},icon:b?null:e.jsx(Y,{})})}),b&&e.jsx(he,{onSubmit:_==="create"?R:z,setAddUserForm:x,type:_,currentUserInfos:w},_),e.jsx("div",{className:f.userManagementTableContainer,children:e.jsxs("table",{className:f.managementTable,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s[a].backoffice.userManagement.username}),e.jsx("th",{children:s[a].backoffice.userManagement.pseudo}),e.jsx("th",{children:s[a].backoffice.userManagement.status}),e.jsx("th",{children:s[a].backoffice.userManagement.links})]})}),e.jsx("tbody",{children:o.map(n=>e.jsxs("tr",{className:f.userTableRow,children:[e.jsx("td",{children:n.username}),e.jsx("td",{children:n.pseudo}),e.jsx("td",{children:s[a].backoffice.userManagement[n.status]}),e.jsx("td",{children:e.jsxs("div",{children:[l!==n.id?e.jsx(e.Fragment,{children:e.jsx("button",{type:"button",onClick:()=>P(n.id),children:n.status==="admin"?s[a].backoffice.userManagement.toAuthor:s[a].backoffice.userManagement.toAdmin})}):e.jsx(e.Fragment,{children:e.jsx(Z,{onClick:()=>{g(n),C("edit"),x(!0),scrollTo({top:0,left:0,behavior:"smooth"})}})}),e.jsx(ee,{color:"#9d2121",onClick:()=>I(n.id,l===n.id)})]})})]},n.id))})]})})]}):e.jsx(J,{})};export{ye as default};
