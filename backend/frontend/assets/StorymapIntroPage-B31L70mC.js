import{c as Ja,r as c,R as X,G as vt,u as xe,ab as me,j as a,B as V,C as _t,U as it,a3 as je,W as J,a1 as be,a2 as Ga,f as fe,J as Qa,S as un,q as dn,e as Za,l as Xt,a4 as at,a5 as er,ac as na,ad as St,P as pn,s as Pn,ae as tr,L as nr,_ as ar,$ as rr,E as or}from"./index-BxFqVAtU.js";import{t as sr,u as ve,g as ir,p as aa}from"./icons-BCZYgyQa.js";import{u as Ge,C as ra}from"./index.esm-DU5Jd49H.js";import{u as Z,E as oa,U as hn,P as lr,F as Xe,h as rt,X as cr,C as ot,S as Mt,p as Ot,a as ur}from"./UpdatePointSetContent-CXd8D4KU.js";import{E as Pe}from"./ErrorComponent-DHhBf5Ed.js";import{s as K}from"./commonForm.module-B0ZibT4L.js";import{C as Je}from"./chevron-left-hb2Ok2KW.js";import{L as de,s as F}from"./LabelComponent-Dc0vkv4j.js";import{c as dr,g as sa,d as yt,u as ia,e as mr}from"./getRequests-D7Jc80Z1.js";import{n as fr,r as gr,a as la,b as pr,h as hr,L as Tn}from"./block-DuJB6ql1.js";import{a as Ft,d as br}from"./deleteRequests-D1QlB_A_.js";import{T as ca}from"./triangle-alert-Dgnm9sIf.js";import{T as Re}from"./mapFormStore-BBEqQX7u.js";import{b as xr,c as vr}from"./putRequests-B23pqD-4.js";import{C as yr}from"./circle-plus-Cot57x0J.js";import{C as It}from"./circle-help-Bu1jh18z.js";import{P as ua}from"./pen-DtWmPD_s.js";import{u as Cr}from"./storymapLanguageStore-D1EAXvCH.js";import{b as jr}from"./deleteRequests-C2HL553e.js";import"./purify.es-CEVJ7K31.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wr=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],_r=Ja("Trash2",wr);function Sr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return c.useMemo(()=>r=>{t.forEach(s=>s(r))},t)}const Ht=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function lt(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function bn(e){return"nodeType"in e}function we(e){var t,n;return e?lt(e)?e:bn(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function xn(e){const{Document:t}=we(e);return e instanceof t}function Tt(e){return lt(e)?!1:e instanceof we(e).HTMLElement}function da(e){return e instanceof we(e).SVGElement}function ct(e){return e?lt(e)?e.document:bn(e)?xn(e)?e:Tt(e)||da(e)?e.ownerDocument:document:document:document}const Le=Ht?c.useLayoutEffect:c.useEffect;function Yt(e){const t=c.useRef(e);return Le(()=>{t.current=e}),c.useCallback(function(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return t.current==null?void 0:t.current(...r)},[])}function Fr(){const e=c.useRef(null),t=c.useCallback((r,s)=>{e.current=setInterval(r,s)},[]),n=c.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function Nt(e,t){t===void 0&&(t=[e]);const n=c.useRef(e);return Le(()=>{n.current!==e&&(n.current=e)},t),n}function Dt(e,t){const n=c.useRef();return c.useMemo(()=>{const r=e(n.current);return n.current=r,r},[...t])}function Bt(e){const t=Yt(e),n=c.useRef(null),r=c.useCallback(s=>{s!==n.current&&(t==null||t(s,n.current)),n.current=s},[]);return[n,r]}function $t(e){const t=c.useRef();return c.useEffect(()=>{t.current=e},[e]),t.current}let nn={};function Et(e,t){return c.useMemo(()=>{if(t)return t;const n=nn[e]==null?0:nn[e]+1;return nn[e]=n,e+"-"+n},[e,t])}function ma(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return r.reduce((o,l)=>{const i=Object.entries(l);for(const[u,m]of i){const f=o[u];f!=null&&(o[u]=f+e*m)}return o},{...t})}}const nt=ma(1),zt=ma(-1);function Ir(e){return"clientX"in e&&"clientY"in e}function Jt(e){if(!e)return!1;const{KeyboardEvent:t}=we(e.target);return t&&e instanceof t}function Nr(e){if(!e)return!1;const{TouchEvent:t}=we(e.target);return t&&e instanceof t}function Ut(e){if(Nr(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return Ir(e)?{x:e.clientX,y:e.clientY}:null}const He=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[He.Translate.toString(e),He.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),Dn="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Pr(e){return e.matches(Dn)?e:e.querySelector(Dn)}const Tr={display:"none"};function Dr(e){let{id:t,value:n}=e;return X.createElement("div",{id:t,style:Tr},n)}function Er(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;const s={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return X.createElement("div",{id:t,style:s,role:"status","aria-live":r,"aria-atomic":!0},n)}function Ar(){const[e,t]=c.useState("");return{announce:c.useCallback(r=>{r!=null&&t(r)},[]),announcement:e}}const fa=c.createContext(null);function Rr(e){const t=c.useContext(fa);c.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function Lr(){const[e]=c.useState(()=>new Set),t=c.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[c.useCallback(r=>{let{type:s,event:o}=r;e.forEach(l=>{var i;return(i=l[s])==null?void 0:i.call(l,o)})},[e]),t]}const kr={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},qr={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function Mr(e){let{announcements:t=qr,container:n,hiddenTextDescribedById:r,screenReaderInstructions:s=kr}=e;const{announce:o,announcement:l}=Ar(),i=Et("DndLiveRegion"),[u,m]=c.useState(!1);if(c.useEffect(()=>{m(!0)},[]),Rr(c.useMemo(()=>({onDragStart(p){let{active:h}=p;o(t.onDragStart({active:h}))},onDragMove(p){let{active:h,over:v}=p;t.onDragMove&&o(t.onDragMove({active:h,over:v}))},onDragOver(p){let{active:h,over:v}=p;o(t.onDragOver({active:h,over:v}))},onDragEnd(p){let{active:h,over:v}=p;o(t.onDragEnd({active:h,over:v}))},onDragCancel(p){let{active:h,over:v}=p;o(t.onDragCancel({active:h,over:v}))}}),[o,t])),!u)return null;const f=X.createElement(X.Fragment,null,X.createElement(Dr,{id:r,value:s.draggable}),X.createElement(Er,{id:i,announcement:l}));return n?vt.createPortal(f,n):f}var ae;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(ae||(ae={}));function Vt(){}function ga(e,t){return c.useMemo(()=>({sensor:e,options:{}}),[e,t])}function pa(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return c.useMemo(()=>[...t].filter(r=>r!=null),[...t])}const ke=Object.freeze({x:0,y:0});function Or(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Br(e,t){const n=Ut(e);if(!n)return"0 0";const r={x:(n.x-t.left)/t.width*100,y:(n.y-t.top)/t.height*100};return r.x+"% "+r.y+"%"}function $r(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return n-r}function zr(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function Ur(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function En(e,t,n){return t===void 0&&(t=e.left),n===void 0&&(n=e.top),{x:t+e.width*.5,y:n+e.height*.5}}const ha=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const s=En(t,t.left,t.top),o=[];for(const l of r){const{id:i}=l,u=n.get(i);if(u){const m=Or(En(u),s);o.push({id:i,data:{droppableContainer:l,value:m}})}}return o.sort($r)};function Vr(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),s=Math.min(t.left+t.width,e.left+e.width),o=Math.min(t.top+t.height,e.top+e.height),l=s-r,i=o-n;if(r<s&&n<o){const u=t.width*t.height,m=e.width*e.height,f=l*i,p=f/(u+m-f);return Number(p.toFixed(4))}return 0}const Wr=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const s=[];for(const o of r){const{id:l}=o,i=n.get(l);if(i){const u=Vr(i,t);u>0&&s.push({id:l,data:{droppableContainer:o,value:u}})}}return s.sort(zr)};function Kr(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function ba(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:ke}function Xr(e){return function(n){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return s.reduce((l,i)=>({...l,top:l.top+e*i.y,bottom:l.bottom+e*i.y,left:l.left+e*i.x,right:l.right+e*i.x}),{...n})}}const Hr=Xr(1);function xa(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function Yr(e,t,n){const r=xa(t);if(!r)return e;const{scaleX:s,scaleY:o,x:l,y:i}=r,u=e.left-l-(1-s)*parseFloat(n),m=e.top-i-(1-o)*parseFloat(n.slice(n.indexOf(" ")+1)),f=s?e.width/s:e.width,p=o?e.height/o:e.height;return{width:f,height:p,top:m,right:u+f,bottom:m+p,left:u}}const Jr={ignoreTransform:!1};function ut(e,t){t===void 0&&(t=Jr);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:m,transformOrigin:f}=we(e).getComputedStyle(e);m&&(n=Yr(n,m,f))}const{top:r,left:s,width:o,height:l,bottom:i,right:u}=n;return{top:r,left:s,width:o,height:l,bottom:i,right:u}}function An(e){return ut(e,{ignoreTransform:!0})}function Gr(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function Qr(e,t){return t===void 0&&(t=we(e).getComputedStyle(e)),t.position==="fixed"}function Zr(e,t){t===void 0&&(t=we(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(s=>{const o=t[s];return typeof o=="string"?n.test(o):!1})}function vn(e,t){const n=[];function r(s){if(t!=null&&n.length>=t||!s)return n;if(xn(s)&&s.scrollingElement!=null&&!n.includes(s.scrollingElement))return n.push(s.scrollingElement),n;if(!Tt(s)||da(s)||n.includes(s))return n;const o=we(e).getComputedStyle(s);return s!==e&&Zr(s,o)&&n.push(s),Qr(s,o)?n:r(s.parentNode)}return e?r(e):n}function va(e){const[t]=vn(e,1);return t??null}function an(e){return!Ht||!e?null:lt(e)?e:bn(e)?xn(e)||e===ct(e).scrollingElement?window:Tt(e)?e:null:null}function ya(e){return lt(e)?e.scrollX:e.scrollLeft}function Ca(e){return lt(e)?e.scrollY:e.scrollTop}function mn(e){return{x:ya(e),y:Ca(e)}}var se;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(se||(se={}));function ja(e){return!Ht||!e?!1:e===document.scrollingElement}function wa(e){const t={x:0,y:0},n=ja(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},s=e.scrollTop<=t.y,o=e.scrollLeft<=t.x,l=e.scrollTop>=r.y,i=e.scrollLeft>=r.x;return{isTop:s,isLeft:o,isBottom:l,isRight:i,maxScroll:r,minScroll:t}}const eo={x:.2,y:.2};function to(e,t,n,r,s){let{top:o,left:l,right:i,bottom:u}=n;r===void 0&&(r=10),s===void 0&&(s=eo);const{isTop:m,isBottom:f,isLeft:p,isRight:h}=wa(e),v={x:0,y:0},j={x:0,y:0},g={height:t.height*s.y,width:t.width*s.x};return!m&&o<=t.top+g.height?(v.y=se.Backward,j.y=r*Math.abs((t.top+g.height-o)/g.height)):!f&&u>=t.bottom-g.height&&(v.y=se.Forward,j.y=r*Math.abs((t.bottom-g.height-u)/g.height)),!h&&i>=t.right-g.width?(v.x=se.Forward,j.x=r*Math.abs((t.right-g.width-i)/g.width)):!p&&l<=t.left+g.width&&(v.x=se.Backward,j.x=r*Math.abs((t.left+g.width-l)/g.width)),{direction:v,speed:j}}function no(e){if(e===document.scrollingElement){const{innerWidth:o,innerHeight:l}=window;return{top:0,left:0,right:o,bottom:l,width:o,height:l}}const{top:t,left:n,right:r,bottom:s}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:s,width:e.clientWidth,height:e.clientHeight}}function _a(e){return e.reduce((t,n)=>nt(t,mn(n)),ke)}function ao(e){return e.reduce((t,n)=>t+ya(n),0)}function ro(e){return e.reduce((t,n)=>t+Ca(n),0)}function Sa(e,t){if(t===void 0&&(t=ut),!e)return;const{top:n,left:r,bottom:s,right:o}=t(e);va(e)&&(s<=0||o<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const oo=[["x",["left","right"],ao],["y",["top","bottom"],ro]];class yn{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=vn(n),s=_a(r);this.rect={...t},this.width=t.width,this.height=t.height;for(const[o,l,i]of oo)for(const u of l)Object.defineProperty(this,u,{get:()=>{const m=i(r),f=s[o]-m;return this.rect[u]+f},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Ct{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=t}add(t,n,r){var s;(s=this.target)==null||s.addEventListener(t,n,r),this.listeners.push([t,n,r])}}function so(e){const{EventTarget:t}=we(e);return e instanceof t?e:ct(e)}function rn(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t?r>t.y:!1}var Ae;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(Ae||(Ae={}));function Rn(e){e.preventDefault()}function io(e){e.stopPropagation()}var $;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})($||($={}));const Fa={start:[$.Space,$.Enter],cancel:[$.Esc],end:[$.Space,$.Enter,$.Tab]},lo=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case $.Right:return{...n,x:n.x+25};case $.Left:return{...n,x:n.x-25};case $.Down:return{...n,y:n.y+25};case $.Up:return{...n,y:n.y-25}}};class Ia{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new Ct(ct(n)),this.windowListeners=new Ct(we(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Ae.Resize,this.handleCancel),this.windowListeners.add(Ae.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Ae.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,r=t.node.current;r&&Sa(r),n(ke)}handleKeyDown(t){if(Jt(t)){const{active:n,context:r,options:s}=this.props,{keyboardCodes:o=Fa,coordinateGetter:l=lo,scrollBehavior:i="smooth"}=s,{code:u}=t;if(o.end.includes(u)){this.handleEnd(t);return}if(o.cancel.includes(u)){this.handleCancel(t);return}const{collisionRect:m}=r.current,f=m?{x:m.left,y:m.top}:ke;this.referenceCoordinates||(this.referenceCoordinates=f);const p=l(t,{active:n,context:r.current,currentCoordinates:f});if(p){const h=zt(p,f),v={x:0,y:0},{scrollableAncestors:j}=r.current;for(const g of j){const d=t.code,{isTop:b,isRight:S,isLeft:w,isBottom:C,maxScroll:P,minScroll:x}=wa(g),I=no(g),T={x:Math.min(d===$.Right?I.right-I.width/2:I.right,Math.max(d===$.Right?I.left:I.left+I.width/2,p.x)),y:Math.min(d===$.Down?I.bottom-I.height/2:I.bottom,Math.max(d===$.Down?I.top:I.top+I.height/2,p.y))},R=d===$.Right&&!S||d===$.Left&&!w,q=d===$.Down&&!C||d===$.Up&&!b;if(R&&T.x!==p.x){const L=g.scrollLeft+h.x,M=d===$.Right&&L<=P.x||d===$.Left&&L>=x.x;if(M&&!h.y){g.scrollTo({left:L,behavior:i});return}M?v.x=g.scrollLeft-L:v.x=d===$.Right?g.scrollLeft-P.x:g.scrollLeft-x.x,v.x&&g.scrollBy({left:-v.x,behavior:i});break}else if(q&&T.y!==p.y){const L=g.scrollTop+h.y,M=d===$.Down&&L<=P.y||d===$.Up&&L>=x.y;if(M&&!h.x){g.scrollTo({top:L,behavior:i});return}M?v.y=g.scrollTop-L:v.y=d===$.Down?g.scrollTop-P.y:g.scrollTop-x.y,v.y&&g.scrollBy({top:-v.y,behavior:i});break}}this.handleMove(t,nt(zt(p,this.referenceCoordinates),v))}}}handleMove(t,n){const{onMove:r}=this.props;t.preventDefault(),r(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Ia.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=Fa,onActivation:s}=t,{active:o}=n;const{code:l}=e.nativeEvent;if(r.start.includes(l)){const i=o.activatorNode.current;return i&&e.target!==i?!1:(e.preventDefault(),s==null||s({event:e.nativeEvent}),!0)}return!1}}];function Ln(e){return!!(e&&"distance"in e)}function kn(e){return!!(e&&"delay"in e)}class Cn{constructor(t,n,r){var s;r===void 0&&(r=so(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:o}=t,{target:l}=o;this.props=t,this.events=n,this.document=ct(l),this.documentListeners=new Ct(this.document),this.listeners=new Ct(r),this.windowListeners=new Ct(we(l)),this.initialCoordinates=(s=Ut(o))!=null?s:ke,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(Ae.Resize,this.handleCancel),this.windowListeners.add(Ae.DragStart,Rn),this.windowListeners.add(Ae.VisibilityChange,this.handleCancel),this.windowListeners.add(Ae.ContextMenu,Rn),this.documentListeners.add(Ae.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(kn(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(Ln(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:r,onPending:s}=this.props;s(r,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(Ae.Click,io,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Ae.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:r,initialCoordinates:s,props:o}=this,{onMove:l,options:{activationConstraint:i}}=o;if(!s)return;const u=(n=Ut(t))!=null?n:ke,m=zt(s,u);if(!r&&i){if(Ln(i)){if(i.tolerance!=null&&rn(m,i.tolerance))return this.handleCancel();if(rn(m,i.distance))return this.handleStart()}if(kn(i)&&rn(m,i.tolerance))return this.handleCancel();this.handlePending(i,m);return}t.cancelable&&t.preventDefault(),l(u)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===$.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const co={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Gt extends Cn{constructor(t){const{event:n}=t,r=ct(n.target);super(t,co,r)}}Gt.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!n.isPrimary||n.button!==0?!1:(r==null||r({event:n}),!0)}}];const uo={move:{name:"mousemove"},end:{name:"mouseup"}};var fn;(function(e){e[e.RightClick=2]="RightClick"})(fn||(fn={}));class mo extends Cn{constructor(t){super(t,uo,ct(t.event.target))}}mo.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button===fn.RightClick?!1:(r==null||r({event:n}),!0)}}];const on={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class fo extends Cn{constructor(t){super(t,on)}static setup(){return window.addEventListener(on.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(on.move.name,t)};function t(){}}}fo.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:s}=n;return s.length>1?!1:(r==null||r({event:n}),!0)}}];var jt;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(jt||(jt={}));var Wt;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(Wt||(Wt={}));function go(e){let{acceleration:t,activator:n=jt.Pointer,canScroll:r,draggingRect:s,enabled:o,interval:l=5,order:i=Wt.TreeOrder,pointerCoordinates:u,scrollableAncestors:m,scrollableAncestorRects:f,delta:p,threshold:h}=e;const v=ho({delta:p,disabled:!o}),[j,g]=Fr(),d=c.useRef({x:0,y:0}),b=c.useRef({x:0,y:0}),S=c.useMemo(()=>{switch(n){case jt.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case jt.DraggableRect:return s}},[n,s,u]),w=c.useRef(null),C=c.useCallback(()=>{const x=w.current;if(!x)return;const I=d.current.x*b.current.x,T=d.current.y*b.current.y;x.scrollBy(I,T)},[]),P=c.useMemo(()=>i===Wt.TreeOrder?[...m].reverse():m,[i,m]);c.useEffect(()=>{if(!o||!m.length||!S){g();return}for(const x of P){if((r==null?void 0:r(x))===!1)continue;const I=m.indexOf(x),T=f[I];if(!T)continue;const{direction:R,speed:q}=to(x,T,S,t,h);for(const L of["x","y"])v[L][R[L]]||(q[L]=0,R[L]=0);if(q.x>0||q.y>0){g(),w.current=x,j(C,l),d.current=q,b.current=R;return}}d.current={x:0,y:0},b.current={x:0,y:0},g()},[t,C,r,g,o,l,JSON.stringify(S),JSON.stringify(v),j,m,P,f,JSON.stringify(h)])}const po={x:{[se.Backward]:!1,[se.Forward]:!1},y:{[se.Backward]:!1,[se.Forward]:!1}};function ho(e){let{delta:t,disabled:n}=e;const r=$t(t);return Dt(s=>{if(n||!r||!s)return po;const o={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[se.Backward]:s.x[se.Backward]||o.x===-1,[se.Forward]:s.x[se.Forward]||o.x===1},y:{[se.Backward]:s.y[se.Backward]||o.y===-1,[se.Forward]:s.y[se.Forward]||o.y===1}}},[n,t,r])}function bo(e,t){const n=t!=null?e.get(t):void 0,r=n?n.node.current:null;return Dt(s=>{var o;return t==null?null:(o=r??s)!=null?o:null},[r,t])}function xo(e,t){return c.useMemo(()=>e.reduce((n,r)=>{const{sensor:s}=r,o=s.activators.map(l=>({eventName:l.eventName,handler:t(l.handler,r)}));return[...n,...o]},[]),[e,t])}var Pt;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(Pt||(Pt={}));var gn;(function(e){e.Optimized="optimized"})(gn||(gn={}));const qn=new Map;function vo(e,t){let{dragging:n,dependencies:r,config:s}=t;const[o,l]=c.useState(null),{frequency:i,measure:u,strategy:m}=s,f=c.useRef(e),p=d(),h=Nt(p),v=c.useCallback(function(b){b===void 0&&(b=[]),!h.current&&l(S=>S===null?b:S.concat(b.filter(w=>!S.includes(w))))},[h]),j=c.useRef(null),g=Dt(b=>{if(p&&!n)return qn;if(!b||b===qn||f.current!==e||o!=null){const S=new Map;for(let w of e){if(!w)continue;if(o&&o.length>0&&!o.includes(w.id)&&w.rect.current){S.set(w.id,w.rect.current);continue}const C=w.node.current,P=C?new yn(u(C),C):null;w.rect.current=P,P&&S.set(w.id,P)}return S}return b},[e,o,n,p,u]);return c.useEffect(()=>{f.current=e},[e]),c.useEffect(()=>{p||v()},[n,p]),c.useEffect(()=>{o&&o.length>0&&l(null)},[JSON.stringify(o)]),c.useEffect(()=>{p||typeof i!="number"||j.current!==null||(j.current=setTimeout(()=>{v(),j.current=null},i))},[i,p,v,...r]),{droppableRects:g,measureDroppableContainers:v,measuringScheduled:o!=null};function d(){switch(m){case Pt.Always:return!1;case Pt.BeforeDragging:return n;default:return!n}}}function jn(e,t){return Dt(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function yo(e,t){return jn(e,t)}function Co(e){let{callback:t,disabled:n}=e;const r=Yt(t),s=c.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(r)},[r,n]);return c.useEffect(()=>()=>s==null?void 0:s.disconnect(),[s]),s}function Qt(e){let{callback:t,disabled:n}=e;const r=Yt(t),s=c.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(r)},[n]);return c.useEffect(()=>()=>s==null?void 0:s.disconnect(),[s]),s}function jo(e){return new yn(ut(e),e)}function Mn(e,t,n){t===void 0&&(t=jo);const[r,s]=c.useState(null);function o(){s(u=>{if(!e)return null;if(e.isConnected===!1){var m;return(m=u??n)!=null?m:null}const f=t(e);return JSON.stringify(u)===JSON.stringify(f)?u:f})}const l=Co({callback(u){if(e)for(const m of u){const{type:f,target:p}=m;if(f==="childList"&&p instanceof HTMLElement&&p.contains(e)){o();break}}}}),i=Qt({callback:o});return Le(()=>{o(),e?(i==null||i.observe(e),l==null||l.observe(document.body,{childList:!0,subtree:!0})):(i==null||i.disconnect(),l==null||l.disconnect())},[e]),r}function wo(e){const t=jn(e);return ba(e,t)}const On=[];function _o(e){const t=c.useRef(e),n=Dt(r=>e?r&&r!==On&&e&&t.current&&e.parentNode===t.current.parentNode?r:vn(e):On,[e]);return c.useEffect(()=>{t.current=e},[e]),n}function So(e){const[t,n]=c.useState(null),r=c.useRef(e),s=c.useCallback(o=>{const l=an(o.target);l&&n(i=>i?(i.set(l,mn(l)),new Map(i)):null)},[]);return c.useEffect(()=>{const o=r.current;if(e!==o){l(o);const i=e.map(u=>{const m=an(u);return m?(m.addEventListener("scroll",s,{passive:!0}),[m,mn(m)]):null}).filter(u=>u!=null);n(i.length?new Map(i):null),r.current=e}return()=>{l(e),l(o)};function l(i){i.forEach(u=>{const m=an(u);m==null||m.removeEventListener("scroll",s)})}},[s,e]),c.useMemo(()=>e.length?t?Array.from(t.values()).reduce((o,l)=>nt(o,l),ke):_a(e):ke,[e,t])}function Bn(e,t){t===void 0&&(t=[]);const n=c.useRef(null);return c.useEffect(()=>{n.current=null},t),c.useEffect(()=>{const r=e!==ke;r&&!n.current&&(n.current=e),!r&&n.current&&(n.current=null)},[e]),n.current?zt(e,n.current):ke}function Fo(e){c.useEffect(()=>{if(!Ht)return;const t=e.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of t)n==null||n()}},e.map(t=>{let{sensor:n}=t;return n}))}function Io(e,t){return c.useMemo(()=>e.reduce((n,r)=>{let{eventName:s,handler:o}=r;return n[s]=l=>{o(l,t)},n},{}),[e,t])}function Na(e){return c.useMemo(()=>e?Gr(e):null,[e])}const $n=[];function No(e,t){t===void 0&&(t=ut);const[n]=e,r=Na(n?we(n):null),[s,o]=c.useState($n);function l(){o(()=>e.length?e.map(u=>ja(u)?r:new yn(t(u),u)):$n)}const i=Qt({callback:l});return Le(()=>{i==null||i.disconnect(),l(),e.forEach(u=>i==null?void 0:i.observe(u))},[e]),s}function Pa(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return Tt(t)?t:e}function Po(e){let{measure:t}=e;const[n,r]=c.useState(null),s=c.useCallback(m=>{for(const{target:f}of m)if(Tt(f)){r(p=>{const h=t(f);return p?{...p,width:h.width,height:h.height}:h});break}},[t]),o=Qt({callback:s}),l=c.useCallback(m=>{const f=Pa(m);o==null||o.disconnect(),f&&(o==null||o.observe(f)),r(f?t(f):null)},[t,o]),[i,u]=Bt(l);return c.useMemo(()=>({nodeRef:i,rect:n,setRef:u}),[n,i,u])}const To=[{sensor:Gt,options:{}},{sensor:Ia,options:{}}],Do={current:{}},qt={draggable:{measure:An},droppable:{measure:An,strategy:Pt.WhileDragging,frequency:gn.Optimized},dragOverlay:{measure:ut}};class wt extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,r;return(n=(r=this.get(t))==null?void 0:r.node.current)!=null?n:void 0}}const Eo={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new wt,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Vt},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:qt,measureDroppableContainers:Vt,windowRect:null,measuringScheduled:!1},Ta={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Vt,draggableNodes:new Map,over:null,measureDroppableContainers:Vt},At=c.createContext(Ta),Da=c.createContext(Eo);function Ao(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new wt}}}function Ro(e,t){switch(t.type){case ae.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case ae.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case ae.DragEnd:case ae.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case ae.RegisterDroppable:{const{element:n}=t,{id:r}=n,s=new wt(e.droppable.containers);return s.set(r,n),{...e,droppable:{...e.droppable,containers:s}}}case ae.SetDroppableDisabled:{const{id:n,key:r,disabled:s}=t,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const l=new wt(e.droppable.containers);return l.set(n,{...o,disabled:s}),{...e,droppable:{...e.droppable,containers:l}}}case ae.UnregisterDroppable:{const{id:n,key:r}=t,s=e.droppable.containers.get(n);if(!s||r!==s.key)return e;const o=new wt(e.droppable.containers);return o.delete(n),{...e,droppable:{...e.droppable,containers:o}}}default:return e}}function Lo(e){let{disabled:t}=e;const{active:n,activatorEvent:r,draggableNodes:s}=c.useContext(At),o=$t(r),l=$t(n==null?void 0:n.id);return c.useEffect(()=>{if(!t&&!r&&o&&l!=null){if(!Jt(o)||document.activeElement===o.target)return;const i=s.get(l);if(!i)return;const{activatorNode:u,node:m}=i;if(!u.current&&!m.current)return;requestAnimationFrame(()=>{for(const f of[u.current,m.current]){if(!f)continue;const p=Pr(f);if(p){p.focus();break}}})}},[r,t,s,l,o]),null}function Ea(e,t){let{transform:n,...r}=t;return e!=null&&e.length?e.reduce((s,o)=>o({transform:s,...r}),n):n}function ko(e){return c.useMemo(()=>({draggable:{...qt.draggable,...e==null?void 0:e.draggable},droppable:{...qt.droppable,...e==null?void 0:e.droppable},dragOverlay:{...qt.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function qo(e){let{activeNode:t,measure:n,initialRect:r,config:s=!0}=e;const o=c.useRef(!1),{x:l,y:i}=typeof s=="boolean"?{x:s,y:s}:s;Le(()=>{if(!l&&!i||!t){o.current=!1;return}if(o.current||!r)return;const m=t==null?void 0:t.node.current;if(!m||m.isConnected===!1)return;const f=n(m),p=ba(f,r);if(l||(p.x=0),i||(p.y=0),o.current=!0,Math.abs(p.x)>0||Math.abs(p.y)>0){const h=va(m);h&&h.scrollBy({top:p.y,left:p.x})}},[t,l,i,r,n])}const Zt=c.createContext({...ke,scaleX:1,scaleY:1});var Ke;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Ke||(Ke={}));const Aa=c.memo(function(t){var n,r,s,o;let{id:l,accessibility:i,autoScroll:u=!0,children:m,sensors:f=To,collisionDetection:p=Wr,measuring:h,modifiers:v,...j}=t;const g=c.useReducer(Ro,void 0,Ao),[d,b]=g,[S,w]=Lr(),[C,P]=c.useState(Ke.Uninitialized),x=C===Ke.Initialized,{draggable:{active:I,nodes:T,translate:R},droppable:{containers:q}}=d,L=I!=null?T.get(I):null,M=c.useRef({initial:null,translated:null}),H=c.useMemo(()=>{var he;return I!=null?{id:I,data:(he=L==null?void 0:L.data)!=null?he:Do,rect:M}:null},[I,L]),te=c.useRef(null),[ie,_e]=c.useState(null),[G,A]=c.useState(null),z=Nt(j,Object.values(j)),Q=Et("DndDescribedBy",l),ge=c.useMemo(()=>q.getEnabled(),[q]),W=ko(h),{droppableRects:re,measureDroppableContainers:ye,measuringScheduled:pe}=vo(ge,{dragging:x,dependencies:[R.x,R.y],config:W.droppable}),Y=bo(T,I),ne=c.useMemo(()=>G?Ut(G):null,[G]),le=Ya(),oe=yo(Y,W.draggable.measure);qo({activeNode:I!=null?T.get(I):null,config:le.layoutShiftCompensation,initialRect:oe,measure:W.draggable.measure});const y=Mn(Y,W.draggable.measure,oe),_=Mn(Y?Y.parentElement:null),E=c.useRef({activatorEvent:null,active:null,activeNode:Y,collisionRect:null,collisions:null,droppableRects:re,draggableNodes:T,draggingNode:null,draggingNodeRect:null,droppableContainers:q,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),D=q.getNodeFor((n=E.current.over)==null?void 0:n.id),U=Po({measure:W.dragOverlay.measure}),ce=(r=U.nodeRef.current)!=null?r:Y,Ce=x?(s=U.rect)!=null?s:y:null,N=!!(U.nodeRef.current&&U.rect),k=wo(N?null:y),O=Na(ce?we(ce):null),B=_o(x?D??Y:null),ee=No(B),Me=Ea(v,{transform:{x:R.x-k.x,y:R.y-k.y,scaleX:1,scaleY:1},activatorEvent:G,active:H,activeNodeRect:y,containerNodeRect:_,draggingNodeRect:Ce,over:E.current.over,overlayNodeRect:U.rect,scrollableAncestors:B,scrollableAncestorRects:ee,windowRect:O}),mt=ne?nt(ne,R):null,ft=So(B),gt=Bn(ft),Ua=Bn(ft,[y]),Qe=nt(Me,gt),Ze=Ce?Hr(Ce,Me):null,pt=H&&Ze?p({active:H,collisionRect:Ze,droppableRects:re,droppableContainers:ge,pointerCoordinates:mt}):null,Sn=Ur(pt,"id"),[ze,Fn]=c.useState(null),Va=N?Me:nt(Me,Ua),Wa=Kr(Va,(o=ze==null?void 0:ze.rect)!=null?o:null,y),en=c.useRef(null),In=c.useCallback((he,Fe)=>{let{sensor:Ie,options:Ue}=Fe;if(te.current==null)return;const Ee=T.get(te.current);if(!Ee)return;const Ne=he.nativeEvent,Oe=new Ie({active:te.current,activeNode:Ee,event:Ne,options:Ue,context:E,onAbort(ue){if(!T.get(ue))return;const{onDragAbort:Be}=z.current,$e={id:ue};Be==null||Be($e),S({type:"onDragAbort",event:$e})},onPending(ue,Ve,Be,$e){if(!T.get(ue))return;const{onDragPending:bt}=z.current,We={id:ue,constraint:Ve,initialCoordinates:Be,offset:$e};bt==null||bt(We),S({type:"onDragPending",event:We})},onStart(ue){const Ve=te.current;if(Ve==null)return;const Be=T.get(Ve);if(!Be)return;const{onDragStart:$e}=z.current,ht={activatorEvent:Ne,active:{id:Ve,data:Be.data,rect:M}};vt.unstable_batchedUpdates(()=>{$e==null||$e(ht),P(Ke.Initializing),b({type:ae.DragStart,initialCoordinates:ue,active:Ve}),S({type:"onDragStart",event:ht}),_e(en.current),A(Ne)})},onMove(ue){b({type:ae.DragMove,coordinates:ue})},onEnd:et(ae.DragEnd),onCancel:et(ae.DragCancel)});en.current=Oe;function et(ue){return async function(){const{active:Be,collisions:$e,over:ht,scrollAdjustedTranslate:bt}=E.current;let We=null;if(Be&&bt){const{cancelDrop:xt}=z.current;We={activatorEvent:Ne,active:Be,collisions:$e,delta:bt,over:ht},ue===ae.DragEnd&&typeof xt=="function"&&await Promise.resolve(xt(We))&&(ue=ae.DragCancel)}te.current=null,vt.unstable_batchedUpdates(()=>{b({type:ue}),P(Ke.Uninitialized),Fn(null),_e(null),A(null),en.current=null;const xt=ue===ae.DragEnd?"onDragEnd":"onDragCancel";if(We){const tn=z.current[xt];tn==null||tn(We),S({type:xt,event:We})}})}}},[T]),Ka=c.useCallback((he,Fe)=>(Ie,Ue)=>{const Ee=Ie.nativeEvent,Ne=T.get(Ue);if(te.current!==null||!Ne||Ee.dndKit||Ee.defaultPrevented)return;const Oe={active:Ne};he(Ie,Fe.options,Oe)===!0&&(Ee.dndKit={capturedBy:Fe.sensor},te.current=Ue,In(Ie,Fe))},[T,In]),Nn=xo(f,Ka);Fo(f),Le(()=>{y&&C===Ke.Initializing&&P(Ke.Initialized)},[y,C]),c.useEffect(()=>{const{onDragMove:he}=z.current,{active:Fe,activatorEvent:Ie,collisions:Ue,over:Ee}=E.current;if(!Fe||!Ie)return;const Ne={active:Fe,activatorEvent:Ie,collisions:Ue,delta:{x:Qe.x,y:Qe.y},over:Ee};vt.unstable_batchedUpdates(()=>{he==null||he(Ne),S({type:"onDragMove",event:Ne})})},[Qe.x,Qe.y]),c.useEffect(()=>{const{active:he,activatorEvent:Fe,collisions:Ie,droppableContainers:Ue,scrollAdjustedTranslate:Ee}=E.current;if(!he||te.current==null||!Fe||!Ee)return;const{onDragOver:Ne}=z.current,Oe=Ue.get(Sn),et=Oe&&Oe.rect.current?{id:Oe.id,rect:Oe.rect.current,data:Oe.data,disabled:Oe.disabled}:null,ue={active:he,activatorEvent:Fe,collisions:Ie,delta:{x:Ee.x,y:Ee.y},over:et};vt.unstable_batchedUpdates(()=>{Fn(et),Ne==null||Ne(ue),S({type:"onDragOver",event:ue})})},[Sn]),Le(()=>{E.current={activatorEvent:G,active:H,activeNode:Y,collisionRect:Ze,collisions:pt,droppableRects:re,draggableNodes:T,draggingNode:ce,draggingNodeRect:Ce,droppableContainers:q,over:ze,scrollableAncestors:B,scrollAdjustedTranslate:Qe},M.current={initial:Ce,translated:Ze}},[H,Y,pt,Ze,T,ce,Ce,re,q,ze,B,Qe]),go({...le,delta:R,draggingRect:Ze,pointerCoordinates:mt,scrollableAncestors:B,scrollableAncestorRects:ee});const Xa=c.useMemo(()=>({active:H,activeNode:Y,activeNodeRect:y,activatorEvent:G,collisions:pt,containerNodeRect:_,dragOverlay:U,draggableNodes:T,droppableContainers:q,droppableRects:re,over:ze,measureDroppableContainers:ye,scrollableAncestors:B,scrollableAncestorRects:ee,measuringConfiguration:W,measuringScheduled:pe,windowRect:O}),[H,Y,y,G,pt,_,U,T,q,re,ze,ye,B,ee,W,pe,O]),Ha=c.useMemo(()=>({activatorEvent:G,activators:Nn,active:H,activeNodeRect:y,ariaDescribedById:{draggable:Q},dispatch:b,draggableNodes:T,over:ze,measureDroppableContainers:ye}),[G,Nn,H,y,b,Q,T,ze,ye]);return X.createElement(fa.Provider,{value:w},X.createElement(At.Provider,{value:Ha},X.createElement(Da.Provider,{value:Xa},X.createElement(Zt.Provider,{value:Wa},m)),X.createElement(Lo,{disabled:(i==null?void 0:i.restoreFocus)===!1})),X.createElement(Mr,{...i,hiddenTextDescribedById:Q}));function Ya(){const he=(ie==null?void 0:ie.autoScrollEnabled)===!1,Fe=typeof u=="object"?u.enabled===!1:u===!1,Ie=x&&!he&&!Fe;return typeof u=="object"?{...u,enabled:Ie}:{enabled:Ie}}}),Mo=c.createContext(null),zn="button",Oo="Draggable";function Bo(e){let{id:t,data:n,disabled:r=!1,attributes:s}=e;const o=Et(Oo),{activators:l,activatorEvent:i,active:u,activeNodeRect:m,ariaDescribedById:f,draggableNodes:p,over:h}=c.useContext(At),{role:v=zn,roleDescription:j="draggable",tabIndex:g=0}=s??{},d=(u==null?void 0:u.id)===t,b=c.useContext(d?Zt:Mo),[S,w]=Bt(),[C,P]=Bt(),x=Io(l,t),I=Nt(n);Le(()=>(p.set(t,{id:t,key:o,node:S,activatorNode:C,data:I}),()=>{const R=p.get(t);R&&R.key===o&&p.delete(t)}),[p,t]);const T=c.useMemo(()=>({role:v,tabIndex:g,"aria-disabled":r,"aria-pressed":d&&v===zn?!0:void 0,"aria-roledescription":j,"aria-describedby":f.draggable}),[r,v,g,d,j,f.draggable]);return{active:u,activatorEvent:i,activeNodeRect:m,attributes:T,isDragging:d,listeners:r?void 0:x,node:S,over:h,setNodeRef:w,setActivatorNodeRef:P,transform:b}}function Ra(){return c.useContext(Da)}const $o="Droppable",zo={timeout:25};function wn(e){let{data:t,disabled:n=!1,id:r,resizeObserverConfig:s}=e;const o=Et($o),{active:l,dispatch:i,over:u,measureDroppableContainers:m}=c.useContext(At),f=c.useRef({disabled:n}),p=c.useRef(!1),h=c.useRef(null),v=c.useRef(null),{disabled:j,updateMeasurementsFor:g,timeout:d}={...zo,...s},b=Nt(g??r),S=c.useCallback(()=>{if(!p.current){p.current=!0;return}v.current!=null&&clearTimeout(v.current),v.current=setTimeout(()=>{m(Array.isArray(b.current)?b.current:[b.current]),v.current=null},d)},[d]),w=Qt({callback:S,disabled:j||!l}),C=c.useCallback((T,R)=>{w&&(R&&(w.unobserve(R),p.current=!1),T&&w.observe(T))},[w]),[P,x]=Bt(C),I=Nt(t);return c.useEffect(()=>{!w||!P.current||(w.disconnect(),p.current=!1,w.observe(P.current))},[P,w]),c.useEffect(()=>(i({type:ae.RegisterDroppable,element:{id:r,key:o,disabled:n,node:P,rect:h,data:I}}),()=>i({type:ae.UnregisterDroppable,key:o,id:r})),[r]),c.useEffect(()=>{n!==f.current.disabled&&(i({type:ae.SetDroppableDisabled,id:r,key:o,disabled:n}),f.current.disabled=n)},[r,o,n,i]),{active:l,rect:h,isOver:(u==null?void 0:u.id)===r,node:P,over:u,setNodeRef:x}}function Uo(e){let{animation:t,children:n}=e;const[r,s]=c.useState(null),[o,l]=c.useState(null),i=$t(n);return!n&&!r&&i&&s(i),Le(()=>{if(!o)return;const u=r==null?void 0:r.key,m=r==null?void 0:r.props.id;if(u==null||m==null){s(null);return}Promise.resolve(t(m,o)).then(()=>{s(null)})},[t,r,o]),X.createElement(X.Fragment,null,n,r?c.cloneElement(r,{ref:l}):null)}const Vo={x:0,y:0,scaleX:1,scaleY:1};function Wo(e){let{children:t}=e;return X.createElement(At.Provider,{value:Ta},X.createElement(Zt.Provider,{value:Vo},t))}const Ko={position:"fixed",touchAction:"none"},Xo=e=>Jt(e)?"transform 250ms ease":void 0,Ho=c.forwardRef((e,t)=>{let{as:n,activatorEvent:r,adjustScale:s,children:o,className:l,rect:i,style:u,transform:m,transition:f=Xo}=e;if(!i)return null;const p=s?m:{...m,scaleX:1,scaleY:1},h={...Ko,width:i.width,height:i.height,top:i.top,left:i.left,transform:He.Transform.toString(p),transformOrigin:s&&r?Br(r,i):void 0,transition:typeof f=="function"?f(r):f,...u};return X.createElement(n,{className:l,style:h,ref:t},o)}),Yo=e=>t=>{let{active:n,dragOverlay:r}=t;const s={},{styles:o,className:l}=e;if(o!=null&&o.active)for(const[i,u]of Object.entries(o.active))u!==void 0&&(s[i]=n.node.style.getPropertyValue(i),n.node.style.setProperty(i,u));if(o!=null&&o.dragOverlay)for(const[i,u]of Object.entries(o.dragOverlay))u!==void 0&&r.node.style.setProperty(i,u);return l!=null&&l.active&&n.node.classList.add(l.active),l!=null&&l.dragOverlay&&r.node.classList.add(l.dragOverlay),function(){for(const[u,m]of Object.entries(s))n.node.style.setProperty(u,m);l!=null&&l.active&&n.node.classList.remove(l.active)}},Jo=e=>{let{transform:{initial:t,final:n}}=e;return[{transform:He.Transform.toString(t)},{transform:He.Transform.toString(n)}]},Go={duration:250,easing:"ease",keyframes:Jo,sideEffects:Yo({styles:{active:{opacity:"0"}}})};function Qo(e){let{config:t,draggableNodes:n,droppableContainers:r,measuringConfiguration:s}=e;return Yt((o,l)=>{if(t===null)return;const i=n.get(o);if(!i)return;const u=i.node.current;if(!u)return;const m=Pa(l);if(!m)return;const{transform:f}=we(l).getComputedStyle(l),p=xa(f);if(!p)return;const h=typeof t=="function"?t:Zo(t);return Sa(u,s.draggable.measure),h({active:{id:o,data:i.data,node:u,rect:s.draggable.measure(u)},draggableNodes:n,dragOverlay:{node:l,rect:s.dragOverlay.measure(m)},droppableContainers:r,measuringConfiguration:s,transform:p})})}function Zo(e){const{duration:t,easing:n,sideEffects:r,keyframes:s}={...Go,...e};return o=>{let{active:l,dragOverlay:i,transform:u,...m}=o;if(!t)return;const f={x:i.rect.left-l.rect.left,y:i.rect.top-l.rect.top},p={scaleX:u.scaleX!==1?l.rect.width*u.scaleX/i.rect.width:1,scaleY:u.scaleY!==1?l.rect.height*u.scaleY/i.rect.height:1},h={x:u.x-f.x,y:u.y-f.y,...p},v=s({...m,active:l,dragOverlay:i,transform:{initial:u,final:h}}),[j]=v,g=v[v.length-1];if(JSON.stringify(j)===JSON.stringify(g))return;const d=r==null?void 0:r({active:l,dragOverlay:i,...m}),b=i.node.animate(v,{duration:t,easing:n,fill:"forwards"});return new Promise(S=>{b.onfinish=()=>{d==null||d(),S()}})}}let Un=0;function es(e){return c.useMemo(()=>{if(e!=null)return Un++,Un},[e])}const ts=X.memo(e=>{let{adjustScale:t=!1,children:n,dropAnimation:r,style:s,transition:o,modifiers:l,wrapperElement:i="div",className:u,zIndex:m=999}=e;const{activatorEvent:f,active:p,activeNodeRect:h,containerNodeRect:v,draggableNodes:j,droppableContainers:g,dragOverlay:d,over:b,measuringConfiguration:S,scrollableAncestors:w,scrollableAncestorRects:C,windowRect:P}=Ra(),x=c.useContext(Zt),I=es(p==null?void 0:p.id),T=Ea(l,{activatorEvent:f,active:p,activeNodeRect:h,containerNodeRect:v,draggingNodeRect:d.rect,over:b,overlayNodeRect:d.rect,scrollableAncestors:w,scrollableAncestorRects:C,transform:x,windowRect:P}),R=jn(h),q=Qo({config:r,draggableNodes:j,droppableContainers:g,measuringConfiguration:S}),L=R?d.setRef:void 0;return X.createElement(Wo,null,X.createElement(Uo,{animation:q},p&&I?X.createElement(Ho,{key:I,id:p.id,ref:L,as:i,activatorEvent:f,adjustScale:t,className:u,transition:o,rect:R,style:{zIndex:m,...s},transform:T},n):null))});function st(e,t,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(t,1)[0]),r}function ns(e,t){return e.reduce((n,r,s)=>{const o=t.get(r);return o&&(n[s]=o),n},Array(e.length))}function Rt(e){return e!==null&&e>=0}function as(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function rs(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const La=e=>{let{rects:t,activeIndex:n,overIndex:r,index:s}=e;const o=st(t,r,n),l=t[s],i=o[s];return!i||!l?null:{x:i.left-l.left,y:i.top-l.top,scaleX:i.width/l.width,scaleY:i.height/l.height}},Lt={scaleX:1,scaleY:1},ka=e=>{var t;let{activeIndex:n,activeNodeRect:r,index:s,rects:o,overIndex:l}=e;const i=(t=o[n])!=null?t:r;if(!i)return null;if(s===n){const m=o[l];return m?{x:0,y:n<l?m.top+m.height-(i.top+i.height):m.top-i.top,...Lt}:null}const u=os(o,s,n);return s>n&&s<=l?{x:0,y:-i.height-u,...Lt}:s<n&&s>=l?{x:0,y:i.height+u,...Lt}:{x:0,y:0,...Lt}};function os(e,t,n){const r=e[t],s=e[t-1],o=e[t+1];return r?n<t?s?r.top-(s.top+s.height):o?o.top-(r.top+r.height):0:o?o.top-(r.top+r.height):s?r.top-(s.top+s.height):0:0}const qa="Sortable",Ma=X.createContext({activeIndex:-1,containerId:qa,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:La,disabled:{draggable:!1,droppable:!1}});function Oa(e){let{children:t,id:n,items:r,strategy:s=La,disabled:o=!1}=e;const{active:l,dragOverlay:i,droppableRects:u,over:m,measureDroppableContainers:f}=Ra(),p=Et(qa,n),h=i.rect!==null,v=c.useMemo(()=>r.map(x=>typeof x=="object"&&"id"in x?x.id:x),[r]),j=l!=null,g=l?v.indexOf(l.id):-1,d=m?v.indexOf(m.id):-1,b=c.useRef(v),S=!as(v,b.current),w=d!==-1&&g===-1||S,C=rs(o);Le(()=>{S&&j&&f(v)},[S,v,j,f]),c.useEffect(()=>{b.current=v},[v]);const P=c.useMemo(()=>({activeIndex:g,containerId:p,disabled:C,disableTransforms:w,items:v,overIndex:d,useDragOverlay:h,sortedRects:ns(v,u),strategy:s}),[g,p,C.draggable,C.droppable,w,v,d,u,h,s]);return X.createElement(Ma.Provider,{value:P},t)}const ss=e=>{let{id:t,items:n,activeIndex:r,overIndex:s}=e;return st(n,r,s).indexOf(t)},is=e=>{let{containerId:t,isSorting:n,wasDragging:r,index:s,items:o,newIndex:l,previousItems:i,previousContainerId:u,transition:m}=e;return!m||!r||i!==o&&s===l?!1:n?!0:l!==s&&t===u},ls={duration:200,easing:"ease"},Ba="transform",cs=He.Transition.toString({property:Ba,duration:0,easing:"linear"}),us={roleDescription:"sortable"};function ds(e){let{disabled:t,index:n,node:r,rect:s}=e;const[o,l]=c.useState(null),i=c.useRef(n);return Le(()=>{if(!t&&n!==i.current&&r.current){const u=s.current;if(u){const m=ut(r.current,{ignoreTransform:!0}),f={x:u.left-m.left,y:u.top-m.top,scaleX:u.width/m.width,scaleY:u.height/m.height};(f.x||f.y)&&l(f)}}n!==i.current&&(i.current=n)},[t,n,r,s]),c.useEffect(()=>{o&&l(null)},[o]),o}function ms(e){let{animateLayoutChanges:t=is,attributes:n,disabled:r,data:s,getNewIndex:o=ss,id:l,strategy:i,resizeObserverConfig:u,transition:m=ls}=e;const{items:f,containerId:p,activeIndex:h,disabled:v,disableTransforms:j,sortedRects:g,overIndex:d,useDragOverlay:b,strategy:S}=c.useContext(Ma),w=fs(r,v),C=f.indexOf(l),P=c.useMemo(()=>({sortable:{containerId:p,index:C,items:f},...s}),[p,s,C,f]),x=c.useMemo(()=>f.slice(f.indexOf(l)),[f,l]),{rect:I,node:T,isOver:R,setNodeRef:q}=wn({id:l,data:P,disabled:w.droppable,resizeObserverConfig:{updateMeasurementsFor:x,...u}}),{active:L,activatorEvent:M,activeNodeRect:H,attributes:te,setNodeRef:ie,listeners:_e,isDragging:G,over:A,setActivatorNodeRef:z,transform:Q}=Bo({id:l,data:P,attributes:{...us,...n},disabled:w.draggable}),ge=Sr(q,ie),W=!!L,re=W&&!j&&Rt(h)&&Rt(d),ye=!b&&G,pe=ye&&re?Q:null,ne=re?pe??(i??S)({rects:g,activeNodeRect:H,activeIndex:h,overIndex:d,index:C}):null,le=Rt(h)&&Rt(d)?o({id:l,items:f,activeIndex:h,overIndex:d}):C,oe=L==null?void 0:L.id,y=c.useRef({activeId:oe,items:f,newIndex:le,containerId:p}),_=f!==y.current.items,E=t({active:L,containerId:p,isDragging:G,isSorting:W,id:l,index:C,items:f,newIndex:y.current.newIndex,previousItems:y.current.items,previousContainerId:y.current.containerId,transition:m,wasDragging:y.current.activeId!=null}),D=ds({disabled:!E,index:C,node:T,rect:I});return c.useEffect(()=>{W&&y.current.newIndex!==le&&(y.current.newIndex=le),p!==y.current.containerId&&(y.current.containerId=p),f!==y.current.items&&(y.current.items=f)},[W,le,p,f]),c.useEffect(()=>{if(oe===y.current.activeId)return;if(oe!=null&&y.current.activeId==null){y.current.activeId=oe;return}const ce=setTimeout(()=>{y.current.activeId=oe},50);return()=>clearTimeout(ce)},[oe]),{active:L,activeIndex:h,attributes:te,data:P,rect:I,index:C,newIndex:le,items:f,isOver:R,isSorting:W,isDragging:G,listeners:_e,node:T,overIndex:d,over:A,setNodeRef:ge,setActivatorNodeRef:z,setDroppableNodeRef:q,setDraggableNodeRef:ie,transform:D??ne,transition:U()};function U(){if(D||_&&y.current.newIndex===C)return cs;if(!(ye&&!Jt(M)||!m)&&(W||E))return He.Transition.toString({...m,property:Ba})}}function fs(e,t){var n,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e==null?void 0:e.draggable)!=null?n:t.draggable,droppable:(r=e==null?void 0:e.droppable)!=null?r:t.droppable}}$.Down,$.Right,$.Up,$.Left;const gs=(e,t)=>{if(e.length>0){const n=e.map(o=>({value:o.id,label:`${o.name.toUpperCase()}`})),r=t.map(o=>o.name).indexOf("lang1"),s=t.map(o=>o.name).indexOf("lang2");return t[r].options=[{value:"0",label:"Choisissez une premire langue"},...n],t[s].options=[{value:"0",label:"Choisissez une deuxime langue"},...n],[...t]}return[]},qe=e=>e.filter(n=>!n.name.includes("_lang2")),dt=(e,t)=>t?e.map(n=>{var r,s,o,l;return n.label_fr.includes("langue 1")?{...n,label_fr:`${n.label_fr} (${(r=t==null?void 0:t.lang1)==null?void 0:r.name.toUpperCase()})`,label_en:`${n.label_en} (${(s=t==null?void 0:t.lang1)==null?void 0:s.name.toUpperCase()})`}:n.label_fr.includes("langue 2")?{...n,label_fr:`${n.label_fr} (${(o=t==null?void 0:t.lang2)==null?void 0:o.name.toUpperCase()})`,label_en:`${n.label_en} ${(l=t==null?void 0:t.lang2)==null?void 0:l.name.toUpperCase()})`}:n}):e,Ye=({onSubmit:e,inputs:t,defaultValues:n,action:r,children:s})=>{const{translation:o,language:l}=xe(),{storymapInfos:i,updateFormType:u}=Z(),[m,f]=me(),[p,h]=c.useState(t),{control:v,register:j,handleSubmit:g,setValue:d,formState:{errors:b},watch:S}=Ge({defaultValues:n??{}});c.useEffect(()=>{n&&(d("category_id",n.category_id),n.lang1&&d("lang1",n.lang1.id),n.lang2&&d("lang2",n.lang2.id),n.relatedMap&&d("relatedMap",n.relatedMap!==""?n.relatedMap:"0"))},[n]);const w=S("lang2");c.useEffect(()=>{if(w===null||w==="0"){const x=qe(t);h(x)}else h(t)},[w,t]);const C=c.useRef(null),P=c.useMemo(()=>dt(p,i),[p,i]);return a.jsxs("form",{onSubmit:g(e),className:K.commonFormContainer,children:[P.map(x=>{var I,T,R,q,L;if(x.type==="select")return a.jsxs("div",{className:K.commonFormInputContainer,children:[a.jsxs("div",{className:K.labelContainer,children:[a.jsxs("label",{htmlFor:x.name,children:[x[`label_${l}`]," ",x.required.value&&a.jsx("span",{style:{color:"#9d2121"},children:"*"})]}),a.jsx("p",{children:x[`description_${l}`]??""})]}),a.jsxs("div",{className:K.inputContainer,children:[a.jsx("select",{...j(x.name,{required:x.required.value}),children:(I=x.options)==null?void 0:I.map(M=>a.jsx("option",{value:M.value,children:M.label},M.value))}),b[x.name]&&a.jsx(Pe,{message:(T=x.required.message)==null?void 0:T[l]})]})]},x.name);if(x.type==="text")return a.jsxs("div",{className:K.commonFormInputContainer,children:[a.jsxs("div",{className:K.labelContainer,children:[a.jsxs("label",{htmlFor:x.name,children:[x[`label_${l}`]," ",x.required.value&&a.jsx("span",{style:{color:"#9d2121"},children:"*"})]}),a.jsx("p",{children:x[`description_${l}`]??""})]}),a.jsxs("div",{className:K.inputContainer,children:[a.jsx("input",{type:"text",...j(x.name,{required:x.required.value})}),x.required.value&&b[x.name]&&a.jsx(Pe,{message:(R=x.required.message)==null?void 0:R[l]})]})]},x.name);if(x.type==="color")return a.jsxs("div",{className:K.commonFormInputContainer,children:[a.jsxs("div",{className:K.labelContainer,children:[a.jsxs("label",{htmlFor:x.name,children:[x[`label_${l}`]," ",x.required.value&&a.jsx("span",{style:{color:"#9d2121"},children:"*"})]}),a.jsx("p",{children:x[`description_${l}`]??""})]}),a.jsxs("div",{className:K.inputContainer,children:[a.jsx("input",{type:"color",defaultValue:"#AD9A85",...j(x.name,{required:x.required.value})}),x.required.value&&b[x.name]&&a.jsx(Pe,{message:(q=x.required.message)==null?void 0:q[l]})]})," "]},x.name);if(x.type==="wysiwyg")return a.jsxs("div",{className:K.commonFormInputContainer,children:[a.jsxs("div",{className:K.labelContainer,children:[a.jsxs("label",{htmlFor:x.name,children:[x[`label_${l}`]," ",x.required.value&&a.jsx("span",{style:{color:"#9d2121"},children:"*"})]}),a.jsx("p",{children:x[`description_${l}`]??""})]}),a.jsxs("div",{className:K.inputContainer,children:[a.jsx(ra,{name:x.name,control:v,render:({field:{onChange:M}})=>a.jsx(oa,{ref:C,onChange:M,defaultValue:n?n[`${x.name}`]:null})}),x.required.value&&b[x.name]&&a.jsx(Pe,{message:(L=x.required.message)==null?void 0:L[l]})]})]},x.name)}),X.Children.map(s,(x,I)=>a.jsx(a.Fragment,{children:x})),a.jsxs("div",{className:K.commonFormContainerButton,children:[a.jsx(V,{type:"button",color:"brown",textContent:o[l].common.back,onClickFunction:()=>{u("blockChoice"),f(void 0)},icon:a.jsx(Je,{})}),a.jsx(V,{type:"submit",color:"brown",textContent:r==="create"?o[l].backoffice.storymapFormPage.form.create:o[l].backoffice.storymapFormPage.form.edit,icon:a.jsx(_t,{})})]})]})},Kt=[{label:"Consortium of Ancient World Mappers",value:"https://cawm.lib.uiowa.edu/tiles/%7Bz%7D/%7Bx%7D/%7By%7D.png/tiles/{z}/{x}/{y}.png"},{label:"Open Street Map Basic",value:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}],ps=[{label_fr:"Langue 1",label_en:"Language 1",description_fr:"La langue principale de la storymap",description_en:"The main language of the storymap",name:"lang1",type:"select",options:[],required:{value:!0,message:{fr:"La langue est requise",en:"The language is required"}}},{label_fr:"Langue 2",label_en:"Language 2",description_fr:"La langue secondaire de la storymap (facultatif)",description_en:"The secondary language of the storymap (optional)",name:"lang2",type:"select",options:[],required:{value:!1}},{label_fr:"Titre en langue 1",label_en:"Title in language 1",description_fr:"",description_en:"",name:"title_lang1",type:"text",required:{value:!0,message:{fr:"Le titre en langue 1 est requis",en:"The title in language 1 is required"}}},{label_fr:"Titre en langue 2",label_en:"Title in language 2",description_fr:"",description_en:"",name:"title_lang2",type:"text",required:{value:!0,message:{fr:"Le titre en langue 2 est requis",en:"The title in language 2 is required"}}},{label_fr:"Sous-titre en langue 1",label_en:"Subtitle in language 1",description_fr:"Ligne d'introduction de la storymap qui est affiche dans le premier bloc",description_en:"Introduction line of the storymap that is displayed in the first block",name:"description_lang1",type:"text",required:{value:!1}},{label_fr:"Sous-titre en langue 2",label_en:"Subtitle in language 2",description_fr:"Ligne d'introduction de la storymap qui est affiche dans le premier bloc",description_en:"Introduction line of the storymap that is displayed in the first block",name:"description_lang2",type:"text",required:{value:!1}},{label_fr:"URL de l'image",label_en:"Image URL",description_fr:"L'image de couverture de la storymap est affiche en arrire plan du titre'",description_en:"The cover image of the storymap is displayed in the background of the title",name:"image_url",type:"text",required:{value:!1}},{label_fr:"Couleur de fond (si aucune image fournie)",label_en:"Background color (if no image provided)",description_fr:"Si aucune image n'est fournie, la couleur de fond est utilise pour le bloc d'introduction",description_en:"If no background image is prrovided, the background color is used for the introduction block",name:"background_color",type:"color",required:{value:!1}},{label_fr:"Auteur",label_en:"Author",description_fr:"L'auteur de la storymap, affich dans les blocs d'introduction et de conclusion de la storymap (peut tre diffrent du compteur auteur de la storymap)",description_en:"The author of the storymap visible in the introduction and conclusion blocks of the storymap (can be different from the storymap author)",name:"author",type:"text",required:{value:!1}},{label_fr:"Dtails sur l'auteur",label_en:"Author details",description_fr:"Dtails sur l'auteur de la storymap, comme son statut, son institution, etc. Cette information est affiche dans le bloc d'introduction et de conclusion de la storymap",description_en:"Details about the author of the storymap, such as their status, institution, etc. This information is displayed in the introduction and conclusion blocks of the storymap",name:"author_status",type:"text",required:{value:!1}},{label_fr:"Email de l'auteur",label_en:"Author email",description_fr:"Email de l'auteur de la storymap. Cette information est affiche dans le bloc de conclusion de la storymap",description_en:"Email of the author of the storymap. This information is displayed in the conclusion block of the storymap",name:"author_email",type:"text",required:{value:!1}},{label_fr:"Date de publication",label_en:"Publication date",description_fr:"La date de publication est affiche dans le bloc d'introduction de la storymap",description_en:"The publication date is displayed in the introduction block of the storymap",name:"publishedAt",type:"text",required:{value:!1}}],Vn=[{label_fr:"Titre en langue 1",label_en:"Title in language 1",name:"content1_lang1",type:"text",required:{value:!0,message:{fr:"Le titre en langue 1 est requis",en:"The title in language 1 is required"}}},{label_fr:"Titre en langue 2",label_en:"Title in language 2",name:"content1_lang2",type:"text",required:{value:!0,message:{fr:"Le titre en langue 2 est requis",en:"The title in language 2 is required"}}}],Wn=[{label_fr:"Sous-titre en langue 1",label_en:"Subtitle in language 1",name:"content1_lang1",type:"text",required:{value:!0,message:{fr:"Le sous-titre en langue 1 est requis",en:"The subtitle in language 1 is required"}}},{label_fr:"Sous-titre en langue 2",label_en:"Subtitle in language 2",name:"content1_lang2",type:"text",required:{value:!0,message:{fr:"Le sous-titre en langue 2 est requis",en:"The subtitle in language 2 is required"}}}],Kn=[{label_fr:"Texte en langue 1",label_en:"Texte in language 1",name:"content1_lang1",type:"wysiwyg",required:{value:!0,message:{fr:"Le texte en langue 1 est requis",en:"The text in language 1 is required"}}},{label_fr:"Texte en langue 2",label_en:"Text in language 2",name:"content1_lang2",type:"wysiwyg",required:{value:!0,message:{fr:"Le texte en langue 2 est requis",en:"The text in language 2 is required"}}}],Xn=[{label_fr:"Texte du lien en langue 1",label_en:"Link text in language 1",name:"content1_lang1",type:"text",required:{value:!0,message:{fr:"Le texte du lien en langue 1 est requis",en:"The link text in language 1 is required"}}},{label_fr:"Texte du lien en langue 2",label_en:"Link text in language 2",name:"content1_lang2",type:"text",required:{value:!0,message:{fr:"Le texte du lien en langue 2 est requis",en:"The link text in language 2 is required"}}},{label_fr:"Lien",label_en:"Link",name:"content2_lang1",type:"text",required:{value:!0,message:{fr:"Le lien est requis",en:"The link is required"}}}],Hn=[{label_fr:"Citation en langue 1",label_en:"Quote in language 1",name:"content1_lang1",type:"text",required:{value:!0,message:{fr:"La citation en langue 1 est requise",en:"The quote in language 1 is required"}}},{label_fr:"Citation en langue 2",label_en:"Quote in language 2",name:"content1_lang2",type:"text",required:{value:!0,message:{fr:"La citation en langue 2 est requise",en:"The quote in language 2 is required"}}},{label_fr:"Source en langue 1",label_en:"Source in language 1",name:"content2_lang1",type:"text",required:{value:!0,message:{fr:"La source en langue 1 est requise",en:"The source in language 1 is required"}}},{label_fr:"Source en langue 2",label_en:"Source in language 2",name:"content2_lang2",type:"text",required:{value:!0,message:{fr:"La source en langue 2 est requise",en:"The source in language 2 is required"}}}],Yn=[{label_fr:"Lien de l'image",label_en:"Link of the image",name:"content1_lang1",type:"text",required:{value:!0,message:{fr:"Le lien de l'image est requis",en:"The link of the image is required"}}},{label_fr:"Lgende de l'image en langue 1",label_en:"Image caption in language 1",name:"content2_lang1",type:"text",required:{value:!0,message:{fr:"La lgende de l'image en langue 1 est requise",en:"The image caption in language 1 is required"}}},{label_fr:"Lgende de l'image en langue 2",label_en:"Image caption in language 2",name:"content2_lang2",type:"text",required:{value:!0,message:{fr:"La lgende de l'image en langue 2 est requise",en:"The image caption in language 2 is required"}}}],Jn=[{label_fr:"Nom de la carte en langue 1",label_en:"Map name in language 1",name:"content1_lang1",type:"text",required:{value:!0,message:{fr:"Le nom de la carte en langue 1 est requis",en:"The map name in language 1 is required"}}},{label_fr:"Nom de la carte en langue 2",label_en:"Map name in language 2",name:"content1_lang2",type:"text",required:{value:!0,message:{fr:"Le nom de la carte en langue 2 est requis",en:"The map name in language 2 is required"}}},{label_fr:"Fond de carte",label_en:"Map background tiles",name:"content2_lang1",type:"select",options:Kt,required:{value:!0,message:{fr:"Le fond de carte est requis",en:"The map background tiles are required"}}}],Gn=[{label_fr:"Nom de la carte en langue 1",label_en:"Map name in language 1",name:"content1_lang1",type:"text",required:{value:!0,message:{fr:"Le nom de la carte en langue 1 est requis",en:"The map name in language 1 is required"}}},{label_fr:"Nom de la carte en langue 2",label_en:"Map name in language 2",name:"content1_lang2",type:"text",required:{value:!0,message:{fr:"Le nom de la carte en langue 2 est requis",en:"The map name in language 2 is required"}}},{label_fr:"Fond de carte pour le panel de gauche",label_en:"Map background tiles for the left panel",name:"content2_lang1",type:"select",options:Kt,required:{value:!0,message:{fr:"Le fond de carte est requis",en:"The map background tiles are required"}}},{label_fr:"Fond de carte pour le panel de droite",label_en:"Map background tiles for the right panel",name:"content2_lang2",type:"select",options:Kt,required:{value:!0,message:{fr:"Le fond de carte est requis",en:"The map background tiles are required"}}}],Qn=[{label_fr:"Nom de la carte en langue 1",label_en:"Map name in language 1",name:"content1_lang1",type:"text",required:{value:!0,message:{fr:"Le nom de la carte en langue 1 est requis",en:"The map name in language 1 is required"}}},{label_fr:"Nom de la carte en langue 2",label_en:"Map name in language 2",name:"content1_lang2",type:"text",required:{value:!0,message:{fr:"Le nom de la carte en langue 2 est requis",en:"The map name in language 2 is required"}}},{label_fr:"Fond de carte",label_en:"Map background tiles",name:"content2_lang1",type:"select",options:Kt,required:{value:!0,message:{fr:"Le fond de carte est requis",en:"The map background tiles are required"}}}],sn=[{label_fr:"Titre en langue 1",label_en:"Title in language 1",name:"content1_lang1",description_fr:"Le titre de l'tape est automatiquement prcd du numro de l'tape, il n'est pas ncessaire de le rajouter.",description_en:"The title of the step is automatically preceded by the step number. It is not necessary to add it.",type:"text",required:{value:!0,message:{fr:"Le titre en langue 1 est requis",en:"The title in language 1 is required"}}},{label_fr:"Titre en langue 2",label_en:"Title in language 2",name:"content1_lang2",description_fr:"Le titre de l'tape est automatiquement prcd du numro de l'tape, il n'est pas ncessaire de le rajouter.",description_en:"The title of the step is automatically preceded by the step number. It is not necessary to add it.",type:"text",required:{value:!0,message:{fr:"Le titre en langue 2 est requis",en:"The title in language 2 is required"}}},{label_fr:"Description en langue 1",label_en:"Description in language 1",name:"content2_lang1",type:"wysiwyg",required:{value:!1}},{label_fr:"Description en langue 2",label_en:"Description in language 2",name:"content2_lang2",type:"wysiwyg",required:{value:!1}}],ln=[{label_fr:"Titre du tableau en langue 1",label_en:"Table title in language 1",name:"content1_lang1",type:"text",required:{value:!0,message:{fr:"Le titre en langue 1 est requis",en:"The title in language 1 is required"}}},{label_fr:"Titre du tableau en langue 2",label_en:"Table title in language 2",name:"content1_lang2",type:"text",required:{value:!0,message:{fr:"Le titre en langue 2 est requis",en:"The title in language 2 is required"}}}],hs=async e=>{try{const t=await it("/storymap/storymap",{method:"POST",data:JSON.stringify(e)});return je("Storymap",!0),t.data}catch(t){t.message==="Request failed with status code 422"?J("Une tiquette au moins est ncessaire pour crer une storymap."):J("Erreur lors de la cration de la storymap")}},bs=async(e,t)=>{try{const n=await it(`/storymap/storymap/${t}`,{method:"PUT",data:JSON.stringify(e)});return be("Storymap",!0),n.data.id}catch{J("Erreur lors de la mise  jour de la storymap")}},Se=async e=>{try{const t=fr(e,gr);return(await it("/storymap/blocks",{method:"POST",data:JSON.stringify(t)})).data}catch{J("Erreur lors de la cration du bloc")}},Te=async(e,t)=>{try{return(await it(`/storymap/blocks/${t}`,{method:"PUT",data:JSON.stringify(e)})).data}catch{J("Erreur lors de la mise  jour du bloc")}},Zn=async(e,t,n,r,s,o)=>{var l;try{let i=e.id??"";if(s==="create"){const u=await Se({...e,storymapId:n,typeName:r,parentId:o});i=u==null?void 0:u.id;const m={...t,blockId:i};await Ft(m),je(r==="step"?"Etape":"Carte simple",!0)}if(s==="edit"){const u=await Te({...e,storymapId:n,typeName:r,parentId:o},i);if(t){const m={...t,name:u.content1_lang1,blockId:i},f=(l=u.attestations[0])==null?void 0:l.id;await it(`/dcart/attestations/${f}`,{method:"DELETE"}),await Ft(m)}be(r==="step"?"Etape":"Carte simple",!0)}}catch{J("Erreur lors de la cration d'une carte simple")}},xs=async(e,t,n,r,s)=>{try{let o=e.id??"";if(s==="create"){const l=await Se({...e,storymapId:n,typeName:r});o=l==null?void 0:l.id;for(const i in t)t[i].blockId=o,await Ft(t[i]);je("Carte de comparaison",!0)}if(s==="edit"){const l=await Te({...e,storymapId:n,typeName:r},o);for(const i in t){const u=l.attestations.find(m=>m.name_fr===i);t[i]&&(await it(`dcart/attestations/${u.id}`,{method:"DELETE"}),t[i].blockId=l.id,await Ft(t[i]))}be("Carte de comparaison",!0)}}catch{J("Erreur lors de la cration d'une carte de comparaison")}},vs=({setStep:e})=>{var d;const{translation:t,language:n}=xe(),{tagOptions:r}=c.useContext(Ga),[s,o]=c.useState(ps);c.useEffect(()=>{(async()=>{const S=await dr(),w=gs(S,s);o(w)})()},[n]);const{storymapId:l}=fe(),[i,u]=c.useState(null),[m,f]=c.useState(!1);c.useEffect(()=>{l!=="create"&&(async S=>{f(!1);const w=await sa(S);u({...w}),f(!0)})(l)},[l]);const[p,h]=c.useState(""),v=Qa(),j=async b=>{if(l==="create"){const S=await hs({...b,lang2:b.lang2==="0"?null:b.lang2,tags:p});u(S),v(`/backoffice/storymaps/${S.id}`)}else{const S={id:i==null?void 0:i.id,title_lang1:b.title_lang1,title_lang2:b.title_lang2,description_lang1:b.description_lang1,description_lang2:b.description_lang2,category_id:b.category_id,image_url:b.image_url,background_color:b.background_color?sr(b.background_color).toHexString():"",author:b.author,author_status:b.author_status??"",author_email:b.author_email??"",lang1:b.lang1,lang2:b.lang2==="0"?null:b.lang2,publishedAt:b.publishedAt,tags:p||(i==null?void 0:i.tags).map(w=>w.id).join("|")};await bs(S,i==null?void 0:i.id)}e(2)},g=c.useMemo(()=>{var b;return(b=i==null?void 0:i.tags)==null?void 0:b.map(S=>({value:S.id,label:S[`name_${n}`]}))},[n,i]);return a.jsxs(a.Fragment,{children:[l==="create"&&a.jsx(Ye,{onSubmit:j,inputs:s,action:"create",children:a.jsxs("div",{className:K.commonFormInputContainer,children:[a.jsx(de,{htmlFor:"tags",label:t[n].backoffice.storymapFormPage.form.tags.label,description:t[n].backoffice.storymapFormPage.form.tags.description}),a.jsx("div",{className:K.inputContainer,children:a.jsx(un,{styles:dn,options:r,delimiter:"|",isMulti:!0,onChange:b=>{const S=b.map(w=>w.value).join("|");h(S)},placeholder:t[n].backoffice.storymapFormPage.form.tags.placeholder})})]})}),m&&a.jsx(Ye,{onSubmit:j,inputs:s,defaultValues:{...i},action:"edit",children:a.jsxs("div",{className:K.commonFormInputContainer,children:[a.jsx(de,{htmlFor:"tags",label:"Etiquettes de la carte",description:"Les tiquettes permettent de classer les cartes et de les retrouver plus facilement."}),a.jsxs("div",{className:K.inputContainer,children:[a.jsx(un,{styles:dn,options:r,defaultValue:i?g:[],delimiter:"|",isMulti:!0,onChange:b=>{const S=b.map(w=>w.value).join("|");h(S)},placeholder:"Choisir une ou plusieurs tiquette"}),l!=="create"&&((d=i==null?void 0:i.tags)==null?void 0:d.length)===0&&a.jsxs("p",{className:K.errorMessage,children:[a.jsx(ca,{size:20})," ",t[n].alert.noTagAssociated]})]})]})})]})},ys="_formTitle_jqk1d_1",Cs={formTitle:ys},De=({action:e,translationKey:t})=>{const{translation:n,language:r}=xe();return a.jsxs("h3",{className:Cs.formTitle,children:[n[r].backoffice.storymapFormPage.form[e==="create"?"create":"edit"]," ",n[r].backoffice.storymapFormPage.form[t]]})},js=()=>{const{storymapInfos:e,updateFormType:t,block:n,reload:r,setReload:s}=Z(ve(h=>h)),[o,l]=me(),i=o.get("action"),{storymapId:u}=fe(),m=async h=>{i==="create"?(await Se({...h,content1_lang2:h.content1_lang1,storymapId:u,typeName:"link"}),je("Bloc lien",!1)):i==="edit"&&(await Te({...n,...h,content1_lang2:h.content1_lang1,storymapId:u,typeName:"link"},n==null?void 0:n.id.toString()),be("Bloc lien",!1)),s(!r),t("blockChoice"),l(void 0)},[f,p]=c.useState(Xn);return c.useEffect(()=>{if(!(e!=null&&e.lang2)){const h=qe(Xn);p(h)}},[e]),a.jsxs(a.Fragment,{children:[a.jsx(De,{action:i,translationKey:"link"}),a.jsx(Ye,{onSubmit:m,inputs:f,defaultValues:n,action:i},n?n.id:"link")]})},ws=()=>{var ne,le,oe;const{translation:e,language:t}=xe(),{hasGrayScale:n}=Za(),{storymapInfos:r,updateFormType:s,block:o,updateBlockContent:l,reload:i,setReload:u}=Z(ve(y=>y)),[m,f]=me(),p=m.get("action"),{storymapId:h}=fe(),[v,j]=c.useState(1),[g,d]=c.useState(null),[b,S]=c.useState(!1),[w,C]=c.useState(null),[P,x]=c.useState(!1),[I,T]=c.useState("bdd");c.useEffect(()=>{o!=null&&o.attestations&&S(!0)},[o==null?void 0:o.attestations]),c.useEffect(()=>{p==="edit"&&(A("content1_lang1",o==null?void 0:o.content1_lang1),A("content1_lang2",o==null?void 0:o.content1_lang2))},[p,o]);const[R,q]=c.useState("create"),L=async y=>{if(p==="create"){const _=await Se({...y,storymapId:h,typeName:"simple_map"});_!=null&&_.id&&(u(!i),l(_),j(2))}if(p==="edit"){const _=await Te({...y,storymapId:h,typeName:"simple_map"},o.id);_!=null&&_.id&&(be("Carte simple",!0),j(2))}},M=g&&typeof g.name_fr=="string"&&g.name_fr.trim()!=="",H=g&&typeof g.name_fr=="string"&&g.name_fr.trim()!==""&&typeof g.name_en=="string"&&g.name_en.trim()!=="",te=!(g!=null&&g.attestationIds)&&(g==null?void 0:g.customPointsArray)&&((ne=g==null?void 0:g.customPointsArray)==null?void 0:ne.length)>0||(g==null?void 0:g.attestationIds)&&!(g!=null&&g.customPointsArray)||(g==null?void 0:g.attestationIds)&&(g==null?void 0:g.customPointsArray)&&(g==null?void 0:g.customPointsArray.length)===0||(g==null?void 0:g.attestationIds)&&(g==null?void 0:g.customPointsArray)&&(g==null?void 0:g.customPointsArray.length)>0,ie=async y=>{if(y.preventDefault(),!te){J("Veuillez charger au moins un fichier de points avant de soumettre le formulaire.");return}if(r!=null&&r.lang2&&!H||!M){J("Veuillez remplir tous les champs obligatoires du formulaire.");return}let _=g;if(g!=null&&g.name_en||(_={..._,name_en:g==null?void 0:g.name_fr}),R==="create"){const E=await Ft(_);if((E==null?void 0:E.status)===201){S(!0);const D=await yt(o==null?void 0:o.id);l(D),je("Jeu de points",!1),d(null)}}if(R==="edit"){const E=await xr(_);if((E==null?void 0:E.status)===200){const D=await yt(o==null?void 0:o.id);l(D),be("Jeu de points",!1),d(null)}}},{register:_e,handleSubmit:G,setValue:A,formState:{errors:z}}=Ge({defaultValues:o}),Q=async y=>{await br(y);const _=await yt(o==null?void 0:o.id);l(_),er("Jeu de points",!1)},ge=async y=>{var E;const _=(E=o==null?void 0:o.attestations)==null?void 0:E.find(D=>D.id===y);_&&(q("edit"),d({..._,blockId:o==null?void 0:o.id,icon:_.icon.id,color:_.color.id}),S(!1))},[W,re]=c.useState(Jn);c.useEffect(()=>{if(!(r!=null&&r.lang2)){const y=qe(Jn),_=dt(y,r);re(_)}},[r]);const[ye,pe]=c.useState([]);c.useEffect(()=>{if(o!=null&&o.attestations){const _=o.attestations.map(E=>E.position).sort((E,D)=>E-D);pe(_)}},[o==null?void 0:o.attestations]);const Y=async(y,_)=>{const E=await vr(y,_,o==null?void 0:o.id,"block");if((E==null?void 0:E.status)===200){const D=await yt(o==null?void 0:o.id);l(D),be("Position du jeu de points",!0)}};return a.jsxs(a.Fragment,{children:[P&&a.jsx(Xt,{onClose:()=>{x(!1)},children:a.jsx(hn,{idToUpdate:w,setIsModalOpen:x,reload:i,setReload:u,mapType:"storymap",pointType:I})}),a.jsx(De,{action:p,translationKey:"simple_map"}),v===1&&a.jsxs("form",{onSubmit:G(L),className:F.mapFormContainer,children:[W.map(y=>{var _,E,D;if(y.type==="text")return a.jsxs("div",{className:F.mapFormInputContainer,children:[a.jsx("div",{className:F.labelContainer,children:a.jsxs("label",{htmlFor:y.name,children:[y[`label_${t}`]," ",y.required.value&&a.jsx("span",{style:{color:"#9d2121"},children:"*"})]})}),a.jsxs("div",{className:F.inputContainer,children:[a.jsx("input",{..._e(y.name,{required:y.required.value})}),y.required.value&&z[y.name]&&a.jsx(Pe,{message:(_=y.required.message)==null?void 0:_[t]})]})]},y.name);if(y.type==="select")return a.jsxs("div",{className:F.mapFormInputContainer,children:[a.jsx("div",{className:F.labelContainer,children:a.jsxs("label",{htmlFor:y.name,children:[y[`label_${t}`]," ",y.required.value&&a.jsx("span",{style:{color:"#9d2121"},children:"*"})]})}),a.jsx("div",{className:F.inputContainer,children:a.jsx("select",{..._e(y.name,{required:y.required.value}),children:(E=y.options)==null?void 0:E.map(U=>a.jsx("option",{value:U.value,children:U.label},U.value))})}),z[y.name]&&a.jsx(Pe,{message:(D=y.required.message)==null?void 0:D[t]})]},y.name)}),a.jsxs("div",{className:F.formButtonNavigation,children:[a.jsx(V,{type:"button",onClickFunction:()=>{s("blockChoice"),f(void 0)},color:"brown",textContent:e[t].common.back,icon:a.jsx(Je,{})}),a.jsx(V,{type:"submit",color:"brown",textContent:p==="create"?e[t].backoffice.storymapFormPage.form.create:e[t].backoffice.storymapFormPage.form.edit}),(o==null?void 0:o.id)&&a.jsx(V,{type:"button",color:"brown",onClickFunction:()=>j(2),textContent:"Aller au jeux de points"})]})]}),v===2&&a.jsxs(a.Fragment,{children:[b&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:F.headerContainer,children:a.jsx(V,{type:"button",color:"brown",textContent:e[t].backoffice.mapFormPage.addMapPoints,onClickFunction:()=>S(!b),icon:a.jsx(yr,{}),isSelected:!0})}),a.jsx("div",{className:F.helpContainer,children:a.jsxs("a",{href:"https://sharedocs.huma-num.fr/wl/?id=dJrDrFA2uDDRqqo5PGnmnkNzaNpFWSEW&fmode=open",target:"_blank",rel:"noreferrer",children:[a.jsx(It,{color:"grey"}),e[t].backoffice.mapFormPage.uploadPointsHelp]})})]}),!b&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:F.helpContainer,children:a.jsxs("a",{href:"https://sharedocs.huma-num.fr/wl/?id=dJrDrFA2uDDRqqo5PGnmnkNzaNpFWSEW&fmode=open",target:"_blank",rel:"noreferrer",children:[a.jsx(It,{color:"grey"}),e[t].backoffice.mapFormPage.uploadPointsHelp]})}),a.jsx(lr,{pointSet:g,setPointSet:d,handleSubmit:ie,parentId:o==null?void 0:o.id,type:"block",action:R,cancelFunction:()=>{d(null),S(!0),q("create")}})]}),(o==null?void 0:o.attestations)&&a.jsxs(a.Fragment,{children:[a.jsxs("table",{className:F.pointSetTable,children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",children:"Position"}),a.jsx("th",{scope:"col",children:`${e[t].backoffice.mapFormPage.pointSetTable.nameLang1} (${(le=r==null?void 0:r.lang1)==null?void 0:le.name.toUpperCase()})`}),(r==null?void 0:r.lang2)&&a.jsx("th",{scope:"col",children:`${e[t].backoffice.mapFormPage.pointSetTable.nameLang2} (${(oe=r==null?void 0:r.lang2)==null?void 0:oe.name.toUpperCase()})`}),a.jsx("th",{scope:"col",children:e[t].backoffice.mapFormPage.pointSetTable.icon}),a.jsx("th",{children:e[t].backoffice.mapFormPage.pointSetTable.downloadBDDCSV}),a.jsx("th",{children:e[t].backoffice.mapFormPage.pointSetTable.downloadCustomCSV}),a.jsx("th",{children:e[t].backoffice.mapFormPage.pointSetTable.lastActivity}),a.jsx("th",{scope:"col"})]})}),a.jsx("tbody",{children:o.attestations.sort((y,_)=>y.position-_.position).map(y=>{var U,ce;const _=ir((U=y.icon)==null?void 0:U.name_en,(ce=y.color)==null?void 0:ce.code_hex,n),E=y.customPointsArray&&y.customPointsArray.length>0,D=y.attestationIds&&y.attestationIds!=="";return a.jsxs("tr",{className:F.pointSetTableRow,children:[a.jsx("td",{children:a.jsx("select",{name:"position",id:"position",onChange:Ce=>{Y(y.id,Ce.target.value)},value:y.position,children:ye.map(Ce=>a.jsx("option",{value:Ce,children:Ce},Ce))})}),a.jsx("td",{children:y.name_fr}),(r==null?void 0:r.lang2)&&a.jsx("td",{children:y.name_en}),a.jsx("td",{children:a.jsx("p",{dangerouslySetInnerHTML:{__html:_}})}),a.jsxs("td",{children:[a.jsx(Re,{text:e[t].backoffice.mapFormPage.pointSetTable.downloadCSV,children:D?a.jsx(Xe,{onClick:()=>rt(y,`${y.name_fr}-bdd.csv`,"mapPoints"),cursor:"pointer"}):a.jsx(Xe,{color:"#a1afc4",cursor:"not-allowed"})}),a.jsx(Re,{text:e[t].button.clean,children:at(y.id,!D,C,x,T,"bdd")})]}),a.jsxs("td",{children:[a.jsx(Re,{text:e[t].backoffice.mapFormPage.pointSetTable.downloadCSV,children:E?a.jsx(Xe,{onClick:()=>rt(y,`${y.name_fr}-custom.csv`,"customPoints"),cursor:"pointer"}):a.jsx(Xe,{color:"#a1afc4",cursor:"not-allowed"})}),a.jsx(Re,{text:e[t].button.clean,children:at(y.id,!E,C,x,T,"custom")})]}),a.jsx("td",{children:y.lastActivity?new Date(y.lastActivity).toLocaleDateString(t,{year:"numeric",month:"long",day:"numeric"}):null}),a.jsxs("td",{children:[a.jsx(ua,{onClick:()=>ge(y.id),onKeyDown:()=>ge(y.id)}),a.jsx(cr,{onClick:()=>Q(y.id),onKeyDown:()=>Q(y.id),color:"#9d2121"})]})]},y.id)})})]}),a.jsx(V,{type:"button",color:"brown",textContent:e[t].common.back,onClickFunction:()=>{j(1)},isSelected:!0})]})]})]})},_s=()=>{const{storymapInfos:e,updateFormType:t,block:n,reload:r,setReload:s}=Z(ve(h=>h)),[o,l]=me(),i=o.get("action"),{storymapId:u}=fe(),m=async h=>{i==="create"?(await Se({...h,storymapId:u,typeName:"quote"}),je("Bloc citation",!1)):i==="edit"&&(await Te({...n,...h,storymapId:u,typeName:"quote"},n==null?void 0:n.id.toString()),be("Bloc citation",!1)),s(!r),t("blockChoice"),l(void 0)},[f,p]=c.useState(Hn);return c.useEffect(()=>{if(!(e!=null&&e.lang2)){const h=qe(Hn);p(h)}},[e]),a.jsxs(a.Fragment,{children:[a.jsx(De,{action:i,translationKey:"quote"}),a.jsx(Ye,{onSubmit:m,inputs:f,defaultValues:n,action:i},n?n.id:"quote")]})},Ss=()=>{const{storymapInfos:e,updateFormType:t,block:n,reload:r,setReload:s}=Z(ve(h=>h)),[o,l]=me(),i=o.get("action"),{storymapId:u}=fe(),m=async h=>{i==="create"?(await Se({...h,storymapId:u,typeName:"subtitle"}),je("Bloc sous-titre",!1)):i==="edit"&&(await Te({...n,...h,storymapId:u,typeName:"subtitle"},n==null?void 0:n.id.toString()),be("Bloc sous-titre",!1)),s(!r),t("blockChoice"),l(void 0)},[f,p]=c.useState(Wn);return c.useEffect(()=>{if(!(e!=null&&e.lang2)){const h=qe(Wn);p(h)}},[e]),a.jsxs(a.Fragment,{children:[a.jsx(De,{action:i,translationKey:"subtitle"}),a.jsx(Ye,{onSubmit:m,inputs:f,defaultValues:n,action:i},n?n.id:"subtitle")]})},$a=({parentId:e,setStep:t,defaultValues:n})=>{const{storymapInfos:r,updateFormType:s,block:o,reload:l,setReload:i}=Z(ve(g=>g)),[u,m]=me(),f=u.get("action"),{storymapId:p}=fe(),h=async g=>{if(!g.content1_lang1||g.content1_lang1==="<p><br></p>"){J("Le contenu du bloc texte est vide.");return}if(r!=null&&r.lang2&&!g.content1_lang2||g.content1_lang2==="<p><br></p>"){J("Le contenu du bloc texte est vide.");return}f==="create"?(await Se({...g,parentId:e,storymapId:p,typeName:"text"}),je("Bloc texte",!1)):f==="edit"&&(await Te({...g,parentId:e,storymapId:p,typeName:"text"},n?n.id:o==null?void 0:o.id.toString()),be("Bloc texte",!1)),i(!l),e?t==null||t(3):s("blockChoice")},[v,j]=c.useState(Kn);return c.useEffect(()=>{if(!(r!=null&&r.lang2)){const g=qe(Kn);j(g)}},[r]),a.jsxs(a.Fragment,{children:[a.jsx(De,{action:f,translationKey:"text"}),a.jsx(Ye,{onSubmit:h,inputs:v,defaultValues:n??o,action:f},o?o.id:"text")]})},Fs=()=>{const{storymapInfos:e,updateFormType:t,block:n,reload:r,setReload:s}=Z(ve(h=>h)),{storymapId:o}=fe(),[l,i]=me(),u=l.get("action"),m=async h=>{u==="create"?(await Se({...h,storymapId:o,typeName:"title"}),je("Bloc titre",!1)):u==="edit"&&(await Te({...n,...h,storymapId:o,typeName:"title"},n==null?void 0:n.id.toString()),be("Bloc titre",!1)),s(!r),t("blockChoice"),i(void 0)},[f,p]=c.useState(Vn);return c.useEffect(()=>{if(!(e!=null&&e.lang2)){const h=qe(Vn);p(h)}},[e]),a.jsxs(a.Fragment,{children:[a.jsx(De,{action:u,translationKey:"title"}),a.jsx(Ye,{onSubmit:m,inputs:f,defaultValues:n,action:u},n?n.id:"title")]})},Is=()=>{var Y,ne,le,oe,y,_,E,D,U,ce,Ce;const{translation:e,language:t}=xe(),n=e[t].backoffice.storymapFormPage.form.fileStatus,{icons:r,colors:s}=c.useContext(na),{storymapInfos:o,updateFormType:l,block:i,reload:u,setReload:m}=Z(ve(N=>N)),[f,p]=c.useState("left"),[h,v]=me(),j=h.get("action"),{storymapId:g}=fe(),[d,b]=c.useState({left:{color:"0",icon:"0",name_fr:"",name_en:"",attestationIds:"",customPointsArray:[]},right:{color:"0",icon:"0",name_fr:"",name_en:"",attestationIds:"",customPointsArray:[]}}),[S,w]=c.useState(null),[C,P]=c.useState("bdd"),[x,I]=c.useState(!1),T=N=>{Ot({event:N,onComplete:(k,O="")=>{if(k.data.length===0){J("Le fichier est vide ou mal format");return}const B=aa(k.data);b(ee=>({...ee,[O]:{...ee[O],name:O,attestationIds:B}})),re(ee=>{var Me;return{...ee,[O]:{db:(Me=N.target.files)==null?void 0:Me[0],custom:ee[O].custom}}})}})},R=N=>{Ot({event:N,onComplete:(k,O="")=>{b(B=>({...B,[O]:{...B[O],name:O,customPointsArray:k.data}})),re(B=>{var ee;return{...B,[O]:{db:B[O].db,custom:(ee=N.target.files)==null?void 0:ee[0]}}})},onError:()=>{J("Erreur lors du chargement du fichier. Vrifier le format.")},headerMapping:{latitude:"latitude",longitude:"longitude",location:"location",sourceNb:"source_nb"},skipLines:0})},[q,L]=c.useState(!1);c.useEffect(()=>{var O,B,ee,Me,mt,ft;const N=(O=i==null?void 0:i.attestations)==null?void 0:O.find(gt=>gt[`name_${t}`]==="left"),k=(B=i==null?void 0:i.attestations)==null?void 0:B.find(gt=>gt[`name_${t}`]==="right");b({left:{...d.left,id:N==null?void 0:N.id,color:(ee=N==null?void 0:N.color)==null?void 0:ee.id,icon:(Me=N==null?void 0:N.icon)==null?void 0:Me.id,attestationIds:N==null?void 0:N.attestationIds,name_fr:"left",customPointsArray:(N==null?void 0:N.customPointsArray)||[]},right:{...d.right,id:k==null?void 0:k.id,color:(mt=k==null?void 0:k.color)==null?void 0:mt.id,icon:(ft=k==null?void 0:k.icon)==null?void 0:ft.id,attestationIds:k==null?void 0:k.attestationIds,name_fr:"right",customPointsArray:(k==null?void 0:k.customPointsArray)||[]}}),L(!0)},[i]),c.useEffect(()=>{j==="edit"&&(Q("content1_lang1",i==null?void 0:i.content1_lang1),Q("content1_lang2",i==null?void 0:i.content1_lang2))},[j,i]);const M=N=>{var k,O,B;return((k=d==null?void 0:d[N])==null?void 0:k.attestationIds)&&(!((O=d==null?void 0:d[N])!=null&&O.customPointsArray)||((B=d==null?void 0:d[N])==null?void 0:B.customPointsArray.length)===0)},H=N=>{var k,O,B;return!((k=d==null?void 0:d[N])!=null&&k.attestationIds)&&(((B=(O=d==null?void 0:d[N])==null?void 0:O.customPointsArray)==null?void 0:B.length)??0)>0},te=N=>{var k,O,B;return((k=d==null?void 0:d[N])==null?void 0:k.attestationIds)&&((O=d==null?void 0:d[N])==null?void 0:O.customPointsArray)&&((B=d==null?void 0:d[N])==null?void 0:B.customPointsArray.length)>0},ie=te("left")||H("left")||M("left"),_e=te("right")||H("right")||M("right"),G=async N=>{if(!N.content1_lang1||!N.content2_lang1||!ie||!_e){J("Veuillez remplir tous les champs obligatoires du formulaire.");return}await xs({...N,id:i==null?void 0:i.id},d,g,"comparison_map",j),m(!u),l("blockChoice"),v(void 0)},{register:A,handleSubmit:z,setValue:Q,formState:{errors:ge}}=Ge({defaultValues:i}),[W,re]=c.useState({left:{db:null,custom:null},right:{db:null,custom:null}}),[ye,pe]=c.useState(Gn);return c.useEffect(()=>{if(!(o!=null&&o.lang2)){const N=Gn.filter(O=>O.name!=="content1_lang2"),k=dt(N,o);pe(k)}},[o]),q&&a.jsxs(a.Fragment,{children:[x&&a.jsx(Xt,{onClose:()=>{I(!1)},children:a.jsx(hn,{idToUpdate:S,setIsModalOpen:I,reload:u,setReload:m,mapType:"storymap",pointType:C})}),a.jsx(De,{action:j,translationKey:"comparison_map"}),a.jsxs("form",{onSubmit:z(G),className:F.mapFormContainer,children:[ye.map(N=>{var k,O,B;if(N.type==="text")return a.jsxs("div",{className:F.mapFormInputContainer,children:[a.jsx("div",{className:F.labelContainer,children:a.jsxs("label",{htmlFor:N.name,children:[N[`label_${t}`]," ",N.required.value&&a.jsx("span",{style:{color:"#9d2121"},children:"*"})]})}),a.jsxs("div",{className:F.inputContainer,children:[a.jsx("input",{...A(N.name,{required:N.required.value})}),ge[N.name]&&a.jsx(Pe,{message:(k=N.required.message)==null?void 0:k[t]})]})]},N.name);if(N.type==="select")return a.jsxs("div",{className:F.mapFormInputContainer,children:[a.jsx("div",{className:F.labelContainer,children:a.jsxs("label",{htmlFor:N.name,children:[N[`label_${t}`]," ",N.required.value&&a.jsx("span",{style:{color:"#9d2121"},children:"*"})]})}),a.jsxs("div",{className:F.inputContainer,children:[a.jsx("select",{...A(N.name,{required:N.required.value}),children:(O=N.options)==null?void 0:O.map(ee=>a.jsx("option",{value:ee.value,children:ee.label},ee.value))}),ge[N.name]&&a.jsx(Pe,{message:(B=N.required.message)==null?void 0:B[t]})]})]},N.name)}),a.jsxs("div",{className:F.panelButtonContainer,children:[a.jsx(V,{color:"brown",type:"button",onClickFunction:()=>p("left"),textContent:e[t].button.leftSide,isSelected:f==="left"}),a.jsx(V,{color:"brown",type:"button",onClickFunction:()=>p("right"),textContent:e[t].button.rightSide,isSelected:f==="right"})]}),a.jsx("div",{className:F.helpContainer,children:a.jsxs("a",{href:"https://sharedocs.huma-num.fr/wl/?id=dJrDrFA2uDDRqqo5PGnmnkNzaNpFWSEW&fmode=open",target:"_blank",rel:"noreferrer",children:[a.jsx(It,{color:"grey"}),e[t].backoffice.mapFormPage.uploadPointsHelp]})}),a.jsxs("div",{className:F.mapFormUploadInputContainer,children:[a.jsxs("div",{className:F.mapFormInputContainer,children:[a.jsx(de,{htmlFor:f,label:`${e[t].backoffice.mapFormPage.pointSetForm.attestationIds.label} ${e[t].backoffice.storymapFormPage.form[f==="left"?"forLeftPane":"forRightPane"]}`,description:e[t].backoffice.mapFormPage.pointSetForm.attestationIds.description,isRequired:!1}),a.jsxs("div",{className:F.inputContainer,children:[a.jsx("input",{id:f,type:"file",accept:".csv",onChange:T},f),a.jsxs("div",{className:F.fileStatusAndDownloadContainer,children:[a.jsxs("p",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[(Y=d[f])!=null&&Y.attestationIds?a.jsx(ot,{color:"green"}):j==="edit"?a.jsx(St,{color:"grey"}):null,W[f].db?`${n.loadedFile} : ${(ne=W[f])==null?void 0:ne.db.name}`:(le=d[f])!=null&&le.attestationIds?n.fileAlreadyLoaded:n.noFile]}),((oe=d[f])==null?void 0:oe.attestationIds)&&a.jsxs("div",{className:F.downloadAndCleanContainer,children:[a.jsx(Re,{text:e[t].backoffice.mapFormPage.pointSetTable.downloadCSV,children:a.jsx(Xe,{cursor:"pointer",onClick:()=>rt(d[f],`${i==null?void 0:i.content1_lang1}-${f}-bdd.csv`,"mapPoints")})}),a.jsx(Re,{text:e[t].button.clean,children:at(d[f].id,!1,w,I,P,"bdd")})]})]})]})]}),a.jsxs("div",{className:F.mapFormInputContainer,children:[a.jsx(de,{htmlFor:f,label:`${e[t].backoffice.mapFormPage.pointSetForm.customPointsFile.label} ${e[t].backoffice.storymapFormPage.form[f==="left"?"forLeftPane":"forRightPane"]}`,description:e[t].backoffice.mapFormPage.pointSetForm.customPointsFile.label,isRequired:!1}),a.jsxs("div",{className:F.inputContainer,children:[a.jsx("input",{id:f,type:"file",accept:".csv",onChange:R},f),a.jsxs("div",{className:F.fileStatusAndDownloadContainer,children:[a.jsxs("p",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[(((_=(y=d[f])==null?void 0:y.customPointsArray)==null?void 0:_.length)??0)>0?a.jsx(ot,{color:"green"}):j==="edit"?a.jsx(St,{color:"grey"}):null,W[f].custom?`${n.loadedFile} : ${(E=W[f])==null?void 0:E.custom.name}`:(((U=(D=d[f])==null?void 0:D.customPointsArray)==null?void 0:U.length)??0)>0?n.fileAlreadyLoaded:n.noFile]}),(((Ce=(ce=d[f])==null?void 0:ce.customPointsArray)==null?void 0:Ce.length)??0)>0&&a.jsxs("div",{className:F.downloadAndCleanContainer,children:[a.jsx(Re,{text:e[t].backoffice.mapFormPage.pointSetTable.downloadCSV,children:a.jsx(Xe,{cursor:"pointer",onClick:()=>rt(d[f],`${i==null?void 0:i.content1_lang1}-${f}-custom.csv`,"customPoints")})}),a.jsx(Re,{text:e[t].button.clean,children:at(d[f].id,!1,w,I,P,"custom")})]})]})]})]}),a.jsxs("div",{className:F.mapFormInputContainer,children:[a.jsx(de,{htmlFor:`${f}ColorId`,label:e[t].backoffice.mapFormPage.pointSetForm.pointColor.label,description:e[t].backoffice.mapFormPage.pointSetForm.pointColor.description,isRequired:!1}),a.jsx("div",{className:F.inputContainer,children:a.jsx(Mt,{selectId:`${f}ColorId`,basicOptionValue:"null",basicOptionContent:e[t].backoffice.mapFormPage.pointSetForm.chooseColor,options:s,onChangeFunction:N=>b({...d,[f]:{...d[f],color:N.target.value}}),value:d[f].color})})]}),a.jsxs("div",{className:F.mapFormInputContainer,children:[a.jsx(de,{htmlFor:`${f}IconId`,label:e[t].backoffice.mapFormPage.pointSetForm.pointIcon.label,description:e[t].backoffice.mapFormPage.pointSetForm.pointIcon.description,isRequired:!1}),a.jsx("div",{className:F.inputContainer,children:a.jsx(Mt,{selectId:`${f}IconId`,basicOptionValue:"null",basicOptionContent:e[t].backoffice.mapFormPage.pointSetForm.chooseIcon,options:r,onChangeFunction:N=>b({...d,[f]:{...d[f],icon:N.target.value}}),value:d[f].icon})})]})]}),a.jsxs("div",{className:F.formButtonNavigation,children:[a.jsx(V,{type:"button",color:"brown",textContent:e[t].common.back,onClickFunction:()=>{l("blockChoice"),v(void 0)},icon:a.jsx(Je,{})}),a.jsx(V,{type:"submit",color:"brown",textContent:j==="create"?e[t].backoffice.storymapFormPage.form.create:e[t].backoffice.storymapFormPage.form.edit})]})]})]})},Ns={display:"flex",alignItems:"flex-start",gap:"10px",paddingBottom:"10px"},Ps={display:"flex",justifyContent:"flex-end",gap:"10px",paddingTop:"10px"},Ts={display:"flex",flexDirection:"column",alignItems:"flex-start",textAlign:"left"},Ds=({block:e,type:t,index:n,isDragging:r})=>{const{translation:s,language:o}=xe(),[l,i]=me(),{openDeleteModal:u}=pn(),{storymapInfos:m,updateFormType:f,updateBlockContent:p}=Z(ve(R=>R)),{selectedLanguage:h}=Cr(),v=la(e.type?e.type.name:t),j=t==="step"?`Etape n${n+1}`:s[o].backoffice.storymapFormPage.types[e.type.name],g=()=>{t==="step"?i({stepAction:"edit",id:e.id}):(i({action:"edit"}),f(e.type.name)),p(e)},d=()=>{p(e),u()},{attributes:b,listeners:S,setNodeRef:w,transform:C,transition:P}=ms({id:e.id}),x={transform:He.Transform.toString(C),transition:P,display:"flex",justifyContent:"space-between",border:"1px solid #e0e0e0",borderRadius:"5px",margin:"10px",padding:"10px",backgroundColor:"white",width:"80%",cursor:"grab"},I=pr(e,h),T=hr(e,m);return a.jsx(a.Fragment,{children:a.jsxs("div",{ref:w,style:{...x,...r&&{border:"2px dashed #bbb",backgroundColor:"#f9f9f9",justifyContent:"center",alignItems:"center",color:"#999",fontStyle:"italic"}},...S,...b,children:[a.jsxs("div",{style:Ns,children:[v,a.jsxs("div",{style:Ts,children:[a.jsx("p",{children:j}),a.jsx("br",{}),I,T&&a.jsxs("p",{style:{color:"#9d2121",fontSize:"0.875rem",display:"flex",alignItems:"center",gap:"10px"},children:[a.jsx(ca,{size:20})," ",s[o].alert.missingTranslation]})]})]}),a.jsxs("div",{style:Ps,children:[a.jsx(ua,{onMouseDown:g,size:20,style:{cursor:"pointer"}}),a.jsx(_r,{onMouseDown:d,size:20,style:{cursor:"pointer"}})]})]})})},_n=c.memo(Ds),Es=({scrollMapContent:e})=>{const{translation:t,language:n}=xe(),{reload:r,updateBlockContent:s}=Z(),[o,l]=me(),i=o.get("stepAction"),[u,m]=c.useState([]);c.useEffect(()=>{const j=async()=>{const g=await yt(e.id);m(g.children)};e!=null&&e.id&&j()},[r]);const f=pa(ga(Gt));function p(j){try{const{active:g,over:d}=j;if(!d||g.id===d.id)return;m(b=>{const S=b.findIndex(C=>C.id===g.id),w=b.findIndex(C=>C.id===d.id);return ia(st(b,S,w)),st(b,S,w)})}catch(g){console.error(g)}}const{setNodeRef:h}=wn({id:"step-droppable"}),v=()=>{l({stepAction:"create"}),s(e)};return a.jsxs("section",{ref:h,className:F.stepPanelSection,children:[a.jsx("h4",{children:t[n].backoffice.storymapFormPage.form.scrollMapStepList}),a.jsx(Aa,{sensors:f,collisionDetection:ha,onDragEnd:p,children:a.jsxs(Oa,{items:u.map(j=>j.id),strategy:ka,children:[u.length>0&&u.map((j,g)=>a.jsx(_n,{block:j,type:"step",index:g},j.id)),i==="edit"&&a.jsx(V,{type:"button",color:"brown",textContent:t[n].backoffice.storymapFormPage.form.addAStep,onClickFunction:v})]})})]})},As=({scrollMapContent:e})=>{var pe,Y,ne,le,oe,y;const{translation:t,language:n}=xe(),{icons:r,colors:s}=c.useContext(na),{storymapInfos:o,block:l,updateBlockContent:i,updateFormType:u,reload:m,setReload:f}=Z(ve(_=>_)),{storymapId:p}=fe(),[h,v]=me(),j=t[n].backoffice.storymapFormPage.form.fileStatus,g=h.get("stepAction"),[d,b]=c.useState(g==="edit"&&((Y=(pe=l==null?void 0:l.attestations)==null?void 0:pe[0])!=null&&Y.attestationIds)?{attestationIds:l.attestations[0].attestationIds,customPointsArray:l.attestations[0].customPointsArray}:null),[S,w]=c.useState(null),[C,P]=c.useState("bdd"),[x,I]=c.useState(!1),T=_=>{Ot({event:_,onComplete:E=>{var U;if(E.data.length===0){J("Le fichier est vide ou mal format");return}const D=aa(E.data);b({...d,attestationIds:D}),z(((U=_.target.files)==null?void 0:U[0])??null)},onError:()=>{J("Erreur lors du chargement du fichier. Vrifier le format.")}})},R=_=>{Ot({event:_,onComplete:E=>{var D;b({...d,customPointsArray:E.data}),ge(((D=_.target.files)==null?void 0:D[0])??null)},onError:()=>{J("Erreur lors du chargement du fichier. Vrifier le format.")},headerMapping:{latitude:"latitude",longitude:"longitude",location:"location",sourceNb:"source_nb"},skipLines:0})},{register:q,handleSubmit:L,formState:{errors:M},reset:H,control:te,setValue:ie}=Ge({defaultValues:{}}),_e=!(d!=null&&d.attestationIds)&&(d==null?void 0:d.customPointsArray)&&((ne=d==null?void 0:d.customPointsArray)==null?void 0:ne.length)>0||(d==null?void 0:d.attestationIds)&&(!(d!=null&&d.customPointsArray)||d.customPointsArray.length===0)||(d==null?void 0:d.attestationIds)&&(d==null?void 0:d.customPointsArray)&&(d==null?void 0:d.customPointsArray.length)>0,G=async _=>{var E,D;try{if(!_e){J("Veuillez charger un fichier CSV avant de soumettre le formulaire.");return}if(!((E=_.content2_lang1)!=null&&E.includes("<p>"))||o!=null&&o.lang2&&!((D=_.content2_lang2)!=null&&D.includes("<p>"))){J("Veuillez remplir tous les champs obligatoires du formulaire.");return}if(g==="create"){let ce=d;d&&(ce={...d,name_fr:_.content1_lang1,name_en:_.content1_lang2},await Zn(_,d[`name_${n}`]?d:ce,p,"step",g,e.id),H(),i(e))}else if(g==="edit"&&d){const ce={...d,name_fr:_.content1_lang1,name_en:_.content1_lang2};await Zn(_,d.name_en?d:ce,p,"step",g,e.id),i(e),H()}b(null),ie("content1_lang1",""),ie("content1_lang2",""),v({stepAction:"create"}),z(null),ge(null),f(!m);const U=document.querySelector('section[class*="storymapFormContent"]');U&&U.scrollTo({top:0,behavior:"smooth"})}catch(U){console.error("Erreur lors de l'envoi du fichier :",U)}};c.useEffect(()=>{g==="edit"?H(l):g==="create"&&(ie("content1_lang1",""),ie("content1_lang2",""))},[g,H,l]),c.useEffect(()=>{var _,E;if(l||b({...d,attestationIds:"",customPointsArray:[],name:"",color:"",icon:""}),g==="edit"&&(l!=null&&l.attestations)){const D=l==null?void 0:l.attestations[0];b({...d,id:D==null?void 0:D.id,attestationIds:D==null?void 0:D.attestationIds,color:(_=D==null?void 0:D.color)==null?void 0:_.id,icon:(E=D==null?void 0:D.icon)==null?void 0:E.id,name_fr:D==null?void 0:D[`name_${n}`],customPointsArray:D!=null&&D.customPointsArray?D.customPointsArray:[]})}},[g,l]);const[A,z]=c.useState(null),[Q,ge]=c.useState(null),W=c.useRef(null),[re,ye]=c.useState(sn);return c.useEffect(()=>{let _=sn;o!=null&&o.lang2||(_=qe(sn));const E=dt(_,o);ye(E)},[o]),a.jsxs("section",{children:[x&&a.jsx(Xt,{onClose:()=>{I(!1)},children:a.jsx(hn,{idToUpdate:S,setIsModalOpen:I,reload:m,setReload:f,mapType:"storymap",pointType:C})}),a.jsx(De,{action:g,translationKey:"step"}),a.jsxs("form",{onSubmit:L(G),className:F.mapFormContainer,children:[re.map(_=>{var E,D;if(_.type==="text")return a.jsxs("div",{className:F.mapFormInputContainer,children:[a.jsx(de,{htmlFor:_.name,label:_[`label_${n}`],description:_[`description_${n}`]??""}),a.jsxs("div",{className:F.inputContainer,children:[a.jsx("input",{...q(_.name,{required:_.required.value})}),_.required.value&&M[_.name]&&a.jsx(Pe,{message:(E=_.required.message)==null?void 0:E[n]})]})]},_.name);if(_.type==="wysiwyg")return a.jsxs("div",{className:F.mapFormInputContainer,children:[a.jsx(de,{htmlFor:_.name,label:_[`label_${n}`],description:_[`description_${n}`]??""}),a.jsxs("div",{className:F.inputContainer,children:[a.jsx(ra,{name:_.name,control:te,render:({field:{onChange:U}})=>a.jsx(oa,{ref:W,onChange:U,defaultValue:l&&l.type.name!=="scroll_map"?l[`${_.name}`]:null},l==null?void 0:l.id)}),_.required.value&&M[_.name]&&a.jsx(Pe,{message:(D=_.required.message)==null?void 0:D[n]})]})]},_.name)}),a.jsx("div",{className:F.helpContainer,children:a.jsxs("a",{href:"https://sharedocs.huma-num.fr/wl/?id=dJrDrFA2uDDRqqo5PGnmnkNzaNpFWSEW&fmode=open",target:"_blank",rel:"noreferrer",children:[a.jsx(It,{color:"grey"}),t[n].backoffice.mapFormPage.uploadPointsHelp]})}),a.jsxs("div",{className:F.mapFormInputContainer,children:[a.jsx(de,{htmlFor:"dbPoints",label:t[n].backoffice.mapFormPage.pointSetForm.attestationIds.label,description:t[n].backoffice.mapFormPage.pointSetForm.attestationIds.description,isRequired:!1}),a.jsxs("div",{className:F.inputContainer,children:[a.jsx("input",{id:"dbPoints",type:"file",accept:".csv",onChange:T}),a.jsxs("div",{className:F.fileStatusAndDownloadContainer,children:[a.jsxs("p",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[d!=null&&d.attestationIds?a.jsx(ot,{color:"green"}):g==="edit"?a.jsx(St,{color:"grey"}):null,A?`${j.loadedFile} : ${A==null?void 0:A.name}`:d!=null&&d.attestationIds?j.fileAlreadyLoaded:j.noFile]}),(d==null?void 0:d.attestationIds)&&a.jsxs("div",{className:F.downloadAndCleanContainer,children:[a.jsx(Re,{text:t[n].backoffice.mapFormPage.pointSetTable.downloadCSV,children:a.jsx(Xe,{cursor:"pointer",onClick:()=>rt(d,`${d==null?void 0:d.name_fr}-bdd.csv`,"mapPoints")})}),a.jsx(Re,{text:t[n].button.clean,children:at(d.id,!1,w,I,P,"bdd")})]})]})]})]}),a.jsxs("div",{className:F.mapFormInputContainer,children:[a.jsx(de,{htmlFor:"customPoints",label:t[n].backoffice.mapFormPage.pointSetForm.customPointsFile.label,description:t[n].backoffice.mapFormPage.pointSetForm.customPointsFile.description,isRequired:!1}),a.jsxs("div",{className:F.inputContainer,children:[a.jsx("input",{id:"customPoints",type:"file",accept:".csv",onChange:R}),a.jsxs("div",{className:F.fileStatusAndDownloadContainer,children:[a.jsxs("p",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[(((le=d==null?void 0:d.customPointsArray)==null?void 0:le.length)??0)>0?a.jsx(ot,{color:"green"}):g==="edit"?a.jsx(St,{color:"grey"}):null,Q?`${j.loadedFile} : ${Q==null?void 0:Q.name}`:(((oe=d==null?void 0:d.customPointsArray)==null?void 0:oe.length)??0)>0?j.fileAlreadyLoaded:j.noFile]}),(((y=d==null?void 0:d.customPointsArray)==null?void 0:y.length)??0)>0&&a.jsxs("div",{className:F.downloadAndCleanContainer,children:[a.jsx(Re,{text:t[n].backoffice.mapFormPage.pointSetTable.downloadCSV,children:a.jsx(Xe,{cursor:"pointer",onClick:()=>rt(d,`${d==null?void 0:d.name_fr}-custom.csv`,"customPoints")})}),a.jsx(Re,{text:t[n].button.clean,children:at(d==null?void 0:d.id,!1,w,I,P,"custom")})]})]})]})]}),a.jsxs("div",{className:F.mapFormInputContainer,children:[a.jsx(de,{htmlFor:"colorId",label:t[n].backoffice.mapFormPage.pointSetForm.pointColor.label,description:t[n].backoffice.mapFormPage.pointSetForm.pointColor.description,isRequired:!1}),a.jsx("div",{className:F.inputContainer,children:a.jsx(Mt,{selectId:"colorId",basicOptionValue:"null",basicOptionContent:t[n].backoffice.mapFormPage.pointSetForm.chooseColor,options:s,onChangeFunction:_=>b({...d,color:_.target.value}),value:(d==null?void 0:d.color)??"null"})})]}),a.jsxs("div",{className:F.mapFormInputContainer,children:[a.jsx(de,{htmlFor:"iconId",label:t[n].backoffice.mapFormPage.pointSetForm.pointIcon.label,description:t[n].backoffice.mapFormPage.pointSetForm.pointIcon.description,isRequired:!1}),a.jsx("div",{className:F.inputContainer,children:a.jsx(Mt,{selectId:"iconId",basicOptionValue:"null",basicOptionContent:t[n].backoffice.mapFormPage.pointSetForm.chooseIcon,options:r,onChangeFunction:_=>b({...d,icon:_.target.value}),value:(d==null?void 0:d.icon)??"null"})})]}),a.jsxs("div",{className:F.formButtonNavigation,children:[a.jsx(V,{type:"button",onClickFunction:()=>{u("scroll_map"),v({action:"edit"})},color:"brown",textContent:t[n].common.back,icon:a.jsx(Je,{})}),a.jsx(V,{type:"submit",color:"brown",textContent:g==="create"?t[n].backoffice.storymapFormPage.form.addTheStep:t[n].backoffice.storymapFormPage.form.modifyStep})]})]},g)]},m.toString())},Rs=()=>{const{translation:e,language:t}=xe(),{storymapInfos:n,block:r,updateFormType:s,reload:o,setReload:l}=Z(ve(C=>C)),[i,u]=me(),m=i.get("action"),{storymapId:f}=fe(),[p,h]=c.useState(r??null),v=async C=>{if(m==="create"){const P=await Se({...C,storymapId:f,typeName:"scroll_map"});h(P),je("Carte droulante",!0)}else m==="edit"&&(await Te({...r,...C,storymapId:f,typeName:"scroll_map"},r==null?void 0:r.id.toString()),h(r),be("Carte droulante",!0));u({...i,stepAction:"create"}),l(!o)},{register:j,handleSubmit:g,setValue:d,formState:{errors:b}}=Ge({defaultValues:r});c.useEffect(()=>{m==="edit"&&(d("content1_lang1",r==null?void 0:r.content1_lang1),d("content1_lang2",r==null?void 0:r.content1_lang2))},[m,r,d]);const[S,w]=c.useState(Qn);return c.useEffect(()=>{if(!(n!=null&&n.lang2)){const C=qe(Qn),P=dt(C,n);w(P)}},[n]),a.jsxs("section",{className:F.scrollMapFormContainer,children:[a.jsx(Es,{scrollMapContent:p}),a.jsxs("section",{className:F.scrollMapFormSection,children:[a.jsx(De,{action:m,translationKey:"scroll_map"}),!(p!=null&&p.id)||m==="edit"?a.jsxs("form",{onSubmit:g(v),className:F.mapFormContainer,children:[S.map(C=>{var P,x,I;if(C.type==="text")return a.jsxs("div",{className:F.mapFormInputContainer,children:[a.jsx("div",{className:F.labelContainer,children:a.jsxs("label",{htmlFor:C.name,children:[C[`label_${t}`]," ",C.required.value&&a.jsx("span",{style:{color:"#9d2121"},children:"*"})]})}),a.jsxs("div",{className:F.inputContainer,children:[a.jsx("input",{...j(C.name,{required:C.required.value})}),b[C.name]&&a.jsx(Pe,{message:(P=C.required.message)==null?void 0:P[t]})]})]},C.name);if(C.type==="select")return a.jsxs("div",{className:F.mapFormInputContainer,children:[a.jsx("div",{className:F.labelContainer,children:a.jsxs("label",{htmlFor:C.name,children:[C[`label_${t}`]," ",C.required.value&&a.jsx("span",{style:{color:"#9d2121"},children:"*"})]})}),a.jsxs("div",{className:F.inputContainer,children:[a.jsx("select",{...j(C.name,{required:C.required.value}),children:(x=C.options)==null?void 0:x.map(T=>a.jsx("option",{value:T.value,children:T.label},T.value))}),b[C.name]&&a.jsx(Pe,{message:(I=C.required.message)==null?void 0:I[t]})]})]},C.name)}),a.jsxs("div",{className:F.formButtonNavigation,children:[a.jsx(V,{type:"button",color:"brown",textContent:e[t].common.back,onClickFunction:()=>{s("blockChoice"),u(void 0)},icon:a.jsx(Je,{})}),a.jsx(V,{type:"submit",color:"brown",textContent:e[t].backoffice.storymapFormPage.form[m==="create"?"create":"edit"]}),m==="edit"&&a.jsx(V,{type:"button",color:"brown",textContent:e[t].backoffice.storymapFormPage.form.goToSteps,onClickFunction:()=>u({stepAction:"create"})})]})]}):a.jsx("div",{className:F.stepFormContainer,children:a.jsx(As,{scrollMapContent:p})})]})]})},za=({parentId:e,defaultValues:t})=>{const{storymapInfos:n,updateFormType:r,block:s,reload:o,setReload:l}=Z(ve(j=>j)),[i,u]=me(),m=i.get("action"),{storymapId:f}=fe(),p=async j=>{m==="create"?(await Se({...j,content1_lang2:j.content1_lang1,parentId:e,storymapId:f,typeName:"image"}),je("Bloc image",!1)):m==="edit"&&(await Te({...j,content1_lang2:j.content1_lang1,parentId:e,storymapId:f,typeName:"image"},t?t.id:s==null?void 0:s.id.toString()),be("Bloc image",!1)),l(!o),r("blockChoice"),u(void 0)},[h,v]=c.useState(Yn);return c.useEffect(()=>{if(!(n!=null&&n.lang2)){const j=qe(Yn);v(j)}},[n]),a.jsxs(a.Fragment,{children:[a.jsx(De,{action:m,translationKey:"image"}),a.jsx(Ye,{onSubmit:p,inputs:h,defaultValues:t??s,action:m},s?s.id:"image")]})},Ls="_layoutFormButtonContainer_u8qv2_1",ks="_navigationButtonContainer_u8qv2_39",ea={layoutFormButtonContainer:Ls,navigationButtonContainer:ks},qs=()=>{const{translation:e,language:t}=xe(),{block:n,reload:r,setReload:s,updateFormType:o}=Z(ve(w=>w)),[l,i]=me(),u=l.get("action"),{storymapId:m}=fe(),[f,p]=c.useState(1),[h,v]=c.useState((n==null?void 0:n.id.toString())||""),j=async w=>{if(u==="create"){const C=await Se({content1_lang1:w,content1_lang2:w,storymapId:m,typeName:"layout"});je("Bloc de mise en page",!1),v(C==null?void 0:C.id.toString())}else if(u==="edit"){const C=await Te({...n,children:[],content1_lang1:w,content1_lang2:w,storymapId:m,typeName:"layout"},n==null?void 0:n.id.toString());be("Bloc de mise en page",!1),v(C==null?void 0:C.id.toString()),i({action:"edit"})}s(!r),p(2)},[g,d]=c.useState(void 0),[b,S]=c.useState(void 0);switch(c.useEffect(()=>{u==="edit"&&(d(n==null?void 0:n.children.find(w=>w.type.name==="text")),S(n==null?void 0:n.children.find(w=>w.type.name==="image")))},[u]),f){case 1:return a.jsxs(a.Fragment,{children:[a.jsx(De,{action:u,translationKey:"layout"}),a.jsx("div",{children:a.jsxs("div",{className:ea.layoutFormButtonContainer,children:[a.jsxs("button",{type:"button",onClick:()=>j("left"),children:[a.jsx(Tn,{}),e[t].backoffice.storymapFormPage.form.imageToLeft]}),a.jsxs("button",{type:"button",onClick:()=>j("right"),children:[a.jsx(Tn,{}),e[t].backoffice.storymapFormPage.form.imageToRight]})]})}),a.jsxs("div",{className:ea.navigationButtonContainer,children:[a.jsx(V,{type:"button",color:"brown",textContent:e[t].common.back,onClickFunction:()=>{o("blockChoice"),i(void 0)},icon:a.jsx(Je,{})}),u==="edit"&&a.jsxs(a.Fragment,{children:[a.jsx(V,{type:"button",color:"brown",textContent:e[t].backoffice.storymapFormPage.form.modifyTextNow,onClickFunction:()=>{p(2)},icon:a.jsx(_t,{})}),a.jsx(V,{type:"button",color:"brown",textContent:e[t].backoffice.storymapFormPage.form.modifyImageNow,onClickFunction:()=>{p(3)},icon:a.jsx(_t,{})})]})]})]});case 2:return a.jsx($a,{parentId:h,setStep:p,defaultValues:g});case 3:return a.jsx(za,{parentId:h,defaultValues:b});default:return null}},Ms="_panelSectionContainer_1bhni_23",Os={panelSectionContainer:Ms},Bs=({blockList:e,setBlockList:t,activeId:n})=>{const{formType:r,reload:s,storymapInfos:o,setStorymapInfos:l}=Z(ve(m=>m)),{storymapId:i}=fe();c.useEffect(()=>{(async()=>{const f=await sa(i);l(f),t(f.blocks)})()},[r,s]);const{setNodeRef:u}=wn({id:"droppable"});return o&&e&&a.jsx("div",{ref:u,className:Os.panelSectionContainer,children:e.map(m=>a.jsx(_n,{block:m,type:m.type.name==="layout"?"layout":"block",isDragging:m.id===n},m.id))})},$s=()=>{const{language:e,translation:t}=xe(),{closeDeleteModal:n}=pn(),{block:r,updateBlockContent:s,reload:o,setReload:l,updateFormType:i}=Z(),u=async m=>{await jr(m),s(null),(r==null?void 0:r.type.name)!=="step"&&i("blockChoice"),n(),l(!o)};return r&&a.jsxs("div",{className:Pn.modalCustomContentContainer,children:[t[e].modal.deleteBlockText,a.jsxs("div",{className:Pn.buttonContainer,children:[a.jsx(V,{type:"button",onClickFunction:()=>u(r.id),color:"green",textContent:t[e].modal.yes}),a.jsx(V,{type:"button",onClickFunction:n,color:"red",textContent:t[e].modal.no})]})]})},zs=()=>{var ie,_e,G;const{translation:e,language:t}=xe(),{storymapInfos:n,updateFormType:r,block:s,reload:o,setReload:l}=Z(ve(A=>A)),[i,u]=me(),m=i.get("action"),{storymapId:f}=fe(),[p,h]=c.useState([]),[v,j]=c.useState([]),g=(A,z)=>{var ge;const Q=(ge=A.target.files)==null?void 0:ge[0];if(Q){const W=new FileReader;W.onload=re=>{var Y;const ye=(Y=re.target)==null?void 0:Y.result,pe=ur.parse(ye,{skipEmptyLines:!0,complete:ne=>{if(ne.data.length===0){J("Le fichier est vide ou mal format");return}tr("Tableau")}});pe.data&&(z===1?(h(pe.data),P(ne=>({...ne,lang1:Q}))):(j(pe.data),P(ne=>({...ne,lang2:Q}))))},W.readAsText(Q)}},{register:d,handleSubmit:b,setValue:S,formState:{errors:w}}=Ge({defaultValues:s}),[C,P]=c.useState({lang1:null,lang2:null}),x=(s==null?void 0:s.content2_lang2)==="[]"&&v.length===0,I=A=>A.length>0,T=(A,z)=>A===null?!1:A===null||(A==null?void 0:A[z])!=="[]",R=I(p)||T(s,"content2_lang1"),L=!(n==null?void 0:n.lang2)||I(v)||T(s,"content2_lang2"),M=async A=>{if(!R){J("Le contenu du bloc tableau langue 1 est vide.");return}if(!L){J("Le contenu du bloc tableau langue 2 est vide.");return}if(m==="create")await Se({...A,content1_lang1:`${A.content1_lang1}`,content2_lang1:JSON.stringify(p),content2_lang2:JSON.stringify(v),content3:A.content3?A.content3:"top",storymapId:f,typeName:"table"}),je("Bloc tableau",!1);else if(m==="edit"){const z={...s,...A,storymapId:f,typeName:"table"};p.length>0&&(z.content2_lang1=JSON.stringify(p)),v.length>0&&(z.content2_lang2=JSON.stringify(v)),await Te(z,s==null?void 0:s.id.toString()),be("Bloc tableau",!1)}l(!o),r("blockChoice"),u(void 0)};c.useEffect(()=>{m==="edit"&&s&&(S("content1_lang1",s.content1_lang1),S("content1_lang2",s.content1_lang2),S("content3",s.content3||"top"))},[m,s]);const[H,te]=c.useState(ln);return c.useEffect(()=>{let A=ln;n!=null&&n.lang2||(A=qe(ln));const z=dt(A,n);te(z)},[n]),a.jsxs(a.Fragment,{children:[a.jsx(De,{action:m,translationKey:"table"}),a.jsx("div",{className:F.helpContainer,children:a.jsxs("a",{href:"https://sharedocs.huma-num.fr/wl/?id=z18NTMXobtyLBHgpTRA0B5l41T0plfQZ&fmode=open",target:"_blank",rel:"noreferrer",children:[a.jsx(It,{color:"grey"}),e[t].backoffice.mapFormPage.uploadPointsHelp]})}),a.jsxs("form",{onSubmit:b(M),className:F.mapFormContainer,children:[H.map(A=>{var z;return a.jsxs("div",{className:F.mapFormInputContainer,children:[a.jsx("div",{className:F.labelContainer,children:a.jsxs("label",{htmlFor:A.name,children:[A[`label_${t}`]," ",A.required.value&&a.jsx("span",{style:{color:"#9d2121"},children:"*"})]})}),a.jsxs("div",{className:F.inputContainer,children:[a.jsx("input",{...d(A.name,{required:A.required.value})}),A.required.value&&w[A.name]&&a.jsx(Pe,{message:(z=A.required.message)==null?void 0:z[t]})]})]},A.name)}),a.jsxs("div",{className:F.mapFormInputContainer,children:[a.jsx(de,{htmlFor:"tableLang1",label:`${e[t].backoffice.storymapFormPage.form.uploadTableFr} (${(ie=n==null?void 0:n.lang1)==null?void 0:ie.name.toUpperCase()})`,description:""}),a.jsxs("div",{className:F.inputContainer,children:[a.jsx("input",{id:"tableLang1",type:"file",accept:".csv",onChange:A=>g(A,1)}),m==="edit"&&a.jsxs("p",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[a.jsx(ot,{color:"green"}),C.lang1===null?"Un fichier est dj charg":`Nouveau fichier charg : ${(_e=C.lang1)==null?void 0:_e.name}`]})]})]}),(n==null?void 0:n.lang2)&&a.jsxs("div",{className:F.mapFormInputContainer,children:[a.jsx(de,{htmlFor:"tableLang2",label:`${e[t].backoffice.storymapFormPage.form.uploadTableFr} (${(G=n==null?void 0:n.lang2)==null?void 0:G.name.toUpperCase()})`,description:""}),a.jsxs("div",{className:F.inputContainer,children:[a.jsx("input",{id:"tableLang2",type:"file",accept:".csv",onChange:A=>g(A,2)}),m==="edit"&&a.jsxs("p",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[x?a.jsx(St,{color:"grey"}):a.jsx(ot,{color:"green"}),x?"Fichier  charger":C.lang2===null?"Un fichier est dj charg":`Nouveau fichier charg : ${C.lang2.name}`]})]})]}),a.jsxs("div",{className:F.mapFormInputContainer,children:[a.jsx(de,{htmlFor:"headerPositionTop",label:e[t].backoffice.storymapFormPage.form.headerPosition,description:""}),a.jsxs("div",{className:F.inputContainer,children:[a.jsxs("div",{children:[a.jsx("input",{id:"headerPositionTop",type:"radio",value:"top",...d("content3",{required:!0}),defaultChecked:!0}),a.jsx("label",{htmlFor:"headerPositionTop",children:e[t].backoffice.storymapFormPage.form.headerPositionTop})]}),a.jsxs("div",{children:[a.jsx("input",{id:"headerPositionLeft",type:"radio",value:"left",...d("content3",{required:!0})}),a.jsx("label",{htmlFor:"headerPositionLeft",children:e[t].backoffice.storymapFormPage.form.headerPositionLeft})]})]})]}),a.jsxs("div",{className:F.formButtonNavigation,children:[a.jsx(V,{type:"button",onClickFunction:()=>{r("blockChoice"),u(void 0)},color:"brown",textContent:e[t].common.back,icon:a.jsx(Je,{})}),a.jsx(V,{type:"submit",color:"brown",textContent:e[t].backoffice.storymapFormPage.form[m==="create"?"create":"edit"],icon:a.jsx(_t,{})})]})]})]})},cn=({blockType:e})=>{const{translation:t,language:n}=xe(),[r,s]=me(),{reload:o,setReload:l,updateFormType:i}=Z(),{storymapId:u}=fe(),m=la(e.name),f=async p=>{p.name==="separator"?(await Se({content1_lang1:"",content1_lang2:"",storymapId:u,typeName:"separator"}),je("Bloc sparateur",!1),l(!o)):(i(p.name),s({action:"create"}))};return a.jsxs("li",{onClick:()=>f(e),onKeyUp:()=>f(e),children:[m,t[n].backoffice.storymapFormPage.types[e.name]]},e.id)},Us="_blockChoiceFormContainer_i32jq_1",Vs="_blockChoiceFormList_i32jq_24",kt={blockChoiceFormContainer:Us,blockChoiceFormList:Vs},ta=()=>{const{translation:e,language:t}=xe(),{updateBlockContent:n}=Z(),[r,s]=c.useState([]);c.useEffect(()=>{(async()=>{const m=await mr();s(m)})(),n(null)},[]);const o=c.useMemo(()=>r.filter(u=>u.name==="title"||u.name==="subtitle"||u.name==="text"||u.name==="quote"||u.name==="layout"||u.name==="separator"||u.name==="table").map(u=>a.jsx(cn,{blockType:u},u.id)),[r,t]),l=c.useMemo(()=>r.filter(u=>u.name==="link"||u.name==="itemLink"||u.name==="image").map(u=>a.jsx(cn,{blockType:u},u.id)),[r,t]),i=c.useMemo(()=>r.filter(u=>u.name.includes("map")).map(u=>a.jsx(cn,{blockType:u},u.id)),[r,t]);return r.length?a.jsxs("section",{className:kt.blockChoiceFormContainer,children:[a.jsx("h3",{children:e[t].backoffice.storymapFormPage.chooseBlock}),a.jsxs("div",{children:[a.jsx("h4",{children:e[t].backoffice.storymapFormPage.textContent}),a.jsx("ul",{className:kt.blockChoiceFormList,children:o})]}),a.jsxs("div",{children:[a.jsx("h4",{children:e[t].backoffice.storymapFormPage.mediaContent}),a.jsx("ul",{className:kt.blockChoiceFormList,children:l})]}),a.jsxs("div",{children:[a.jsx("h4",{children:e[t].backoffice.storymapFormPage.mapsContent}),a.jsx("ul",{className:kt.blockChoiceFormList,children:i})]})]}):a.jsx(nr,{})},Ws=()=>{const{translation:e,language:t}=xe(),{updateFormType:n,block:r,reload:s,setReload:o}=Z(ve(I=>I)),[l,i]=me(),u=l.get("action"),{storymapId:m}=fe(),f=async I=>{if(!I.content1_lang1||!I.content1_lang2){J("Aucun contenu slectionn");return}u==="create"?(await Se({...I,storymapId:m,typeName:"itemLink"}),je("Bloc lien de carte ou storymap",!1)):u==="edit"&&(await Te({...r,...I,storymapId:m,typeName:"itemLink"},r==null?void 0:r.id.toString()),be("Bloc lien de carte ou storymap",!1)),o(!s),n("blockChoice"),i(void 0)},[p,h]=c.useState([]),[v,j]=c.useState([]),[g,d]=c.useState([]);c.useEffect(()=>{const I=async()=>{const q=(await ar(!0,"",!1)).map(L=>({label:L[`title_${t}`],value:L.id}));h(q),(!r||(r==null?void 0:r.content1_lang1)==="map")&&d(q)},T=async()=>{const L=(await rr(!0,"",!1)).map(M=>({label:M.title_lang1,value:M.id})).filter(M=>M.value!==m);j(L),(r==null?void 0:r.content1_lang1)==="storymap"&&d(L)};I(),T()},[t,r,m]);const{handleSubmit:b,setValue:S,watch:w}=Ge({defaultValues:{content1_lang1:(r==null?void 0:r.content1_lang1)??"map"}}),[C,P]=c.useState(null);return c.useEffect(()=>{if(r!=null&&r.content1_lang2){const I=g.find(T=>T.value===(r==null?void 0:r.content1_lang2))??g[0];P(I)}},[r==null?void 0:r.content1_lang2,g]),(u==="create"||u==="edit"&&C)&&a.jsxs(a.Fragment,{children:[a.jsx(De,{action:u,translationKey:"itemLink"}),a.jsxs("form",{onSubmit:b(f),className:K.commonFormContainer,children:[a.jsxs("div",{className:K.commonFormInputContainer,children:[a.jsx(de,{label:"Type de contenu",description:"Choisir entre une carte ou un storymap",htmlFor:"content1_lang1"}),a.jsxs("div",{className:K.inputContainer,children:[a.jsxs("div",{children:[a.jsx("input",{type:"radio",id:"content1_lang1",name:"itemType",value:"map",checked:w("content1_lang1")==="map",onChange:()=>{d(p),S("content1_lang1","map"),u==="edit"&&P(p[0])}}),a.jsx("label",{htmlFor:"content1_lang1",children:e[t].common.map})]}),a.jsxs("div",{children:[a.jsx("input",{type:"radio",id:"content1_lang1",name:"itemType",value:"storymap",checked:w("content1_lang1")==="storymap",onChange:()=>{d(v),S("content1_lang1","storymap"),u==="edit"&&P(v[0])}}),a.jsx("label",{htmlFor:"content1_lang1",children:e[t].common.storymap})]})]})]}),a.jsxs("div",{className:K.commonFormInputContainer,children:[a.jsx(de,{label:"Contenu  afficher",description:"Slectionner dans la liste droulante (seuls les lments dj publis sont affichs)",htmlFor:"content1_lang2"}),a.jsx("div",{className:K.inputContainer,children:a.jsx(un,{styles:dn,options:g,placeholder:"Slectionner un lment",onChange:I=>S("content1_lang2",I==null?void 0:I.value),blurInputOnSelect:!0,defaultValue:C,isLoading:!g.length})})]}),a.jsxs("div",{className:K.commonFormContainerButton,children:[a.jsx(V,{type:"button",color:"brown",textContent:e[t].common.back,onClickFunction:()=>{n("blockChoice"),i(void 0)},icon:a.jsx(Je,{})}),a.jsx(V,{type:"submit",color:"brown",textContent:e[t].backoffice.storymapFormPage.form[u],icon:a.jsx(_t,{})})]})]})]})},Ks=({block:e,type:t,index:n})=>a.jsx("div",{style:{transform:"scale(1.05)",opacity:.9},children:a.jsx(_n,{block:e,type:t,index:n})}),Xs="_BOStorymapFormPageContainer_1bqpl_9",Hs="_storymapFormAside_1bqpl_18",Ys="_isSelected_1bqpl_49",Js="_storymapFormAsideHeader_1bqpl_52",Gs="_storymapFormContent_1bqpl_86",tt={BOStorymapFormPageContainer:Xs,storymapFormAside:Hs,isSelected:Ys,storymapFormAsideHeader:Js,storymapFormContent:Gs},xi=()=>{const{translation:e,language:t}=xe(),[n,r]=c.useState(1),{formType:s,updateFormType:o,updateBlockContent:l}=Z(ve(w=>({formType:w.formType,updateFormType:w.updateFormType,updateBlockContent:w.updateBlockContent}))),{isDeleteModalOpen:i,closeDeleteModal:u}=pn(),{storymapId:m}=fe(),{state:f}=or();c.useEffect(()=>{f&&f!=null&&f.from.includes("/storymaps/preview/")&&(r(2),o("blockChoice"),l(null))},[f]);let p=a.jsx(ta,{});switch(s){case"title":p=a.jsx(Fs,{});break;case"subtitle":p=a.jsx(Ss,{});break;case"text":p=a.jsx($a,{});break;case"image":p=a.jsx(za,{});break;case"link":p=a.jsx(js,{});break;case"itemLink":p=a.jsx(Ws,{});break;case"quote":p=a.jsx(_s,{});break;case"layout":p=a.jsx(qs,{});break;case"table":p=a.jsx(zs,{});break;case"simple_map":p=a.jsx(ws,{});break;case"comparison_map":p=a.jsx(Is,{});break;case"scroll_map":p=a.jsx(Rs,{});break;default:p=a.jsx(ta,{})}const[h,v]=c.useState([]),[j,g]=c.useState(null),d=pa(ga(Gt)),b=h.find(w=>w.id===j),S=w=>{try{g(null);const{active:C,over:P}=w;if(!P||C.id===P.id)return;v(x=>{const I=x.findIndex(R=>R.id===C.id),T=x.findIndex(R=>R.id===P.id);return ia(st(x,I,T)),st(x,I,T)})}catch(C){console.error(C)}};return a.jsxs("section",{className:tt.BOStorymapFormPageContainer,children:[i&&a.jsx(Xt,{onClose:()=>u(),children:a.jsx($s,{})}),a.jsxs("aside",{className:tt.storymapFormAside,children:[a.jsx("div",{className:tt.storymapFormAsideHeader,children:m!=="create"&&a.jsx(V,{type:"route",color:"brown",textContent:e[t].backoffice.storymapFormPage.preview,link:`/backoffice/storymaps/preview/${m}`})}),a.jsxs("ul",{children:[a.jsx("li",{onClick:()=>r(1),onKeyUp:()=>r(1),className:n===1?tt.isSelected:"",children:"Introduction"}),m!=="create"&&a.jsx("li",{onClick:()=>{r(2),o("blockChoice")},onKeyUp:()=>{r(2),o("blockChoice")},className:n===2?tt.isSelected:"",children:"Blocs"})]}),m!=="create"&&n===2&&a.jsxs(Aa,{sensors:d,collisionDetection:ha,onDragEnd:S,onDragStart:({active:w})=>g(w.id),children:[a.jsx(Oa,{items:h.map(w=>w.id),strategy:ka,children:a.jsx(Bs,{blockList:h,setBlockList:v,activeId:j})}),a.jsx(ts,{children:b?a.jsx(Ks,{block:b,type:b.type.name==="layout"?"layout":"block"}):null})]})]}),a.jsxs("section",{className:tt.storymapFormContent,children:[n===1&&a.jsx(vs,{setStep:r}),n===2&&p]})]})};export{xi as default};
